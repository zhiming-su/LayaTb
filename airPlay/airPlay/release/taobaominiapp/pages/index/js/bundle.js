var window = $global.window;
var document = window.document;
var XMLHttpRequest = window.XMLHttpRequest;
var Laya = window.Laya;
var Laya3D = window.Laya3D;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(){var e=function(e){function gameControl(){var e;return _classCallCheck(this,gameControl),(e=_possibleConstructorReturn(this,_getPrototypeOf(gameControl).call(this)))._time=0,e.startFlag=!1,e.zdFlage=!1,e.startGame=!1,e.createBoxInterval=1e3,e.fsNum=0,gameControl.instance=_assertThisInitialized(e),Laya.MouseManager.multiTouchEnabled=!1,e}return _inherits(gameControl,Laya.Script),_createClass(gameControl,[{key:"onEnable",value:function(){this._time=Date.now(),this._gameBox=this.owner.getChildByName("gameBox")}},{key:"onDisable",value:function(){}},{key:"stopGame",value:function(){this.startGame=!1,this.owner.getChildByName("end").visible=!0}},{key:"createBox",value:function(){var e=Laya.Pool.getItemByCreateFun("dropBox",this.dropBox.create,this.dropBox);e.pos(Math.random()*(Laya.stage.width-100),-100),this._gameBox.addChild(e)}},{key:"onStart",value:function(){this.startImg.on(Laya.Event.CLICK,this,function(){window.platform.goHome(),this.startGame=!0,this.startImg.visible=!1,this.player.visible=!0,this.fs.visible=!0,this.player.pos(Laya.stage.width/2,Laya.stage.height-this.player.height);var e=Date.now();e-this._time>this.createBoxInterval&&this._started&&(this._time=e,this.createBox())}),this.player.on(Laya.Event.MOUSE_MOVE,this,this.onClickPlayer),Laya.timer.loop(300,this,function(){if(this.startGame){var e=Laya.Pool.getItemByCreateFun("bullet",this.bullet.create,this.bullet);this.zd=e,this.startFlag&&this.zdFlage?e.pos(Laya.stage.mouseX-e.width/2,Laya.stage.mouseY):e.pos(this.player.x-e.width/2,this.player.y-e.height),this._gameBox.addChild(e),this.player.on(Laya.Event.MOUSE_UP,this,function(){this.zdFlage=!1})}})}},{key:"onUpdate",value:function(){var e=Date.now();e-this._time>this.createBoxInterval&&this.startGame&&(this._time=e,this.createBox())}},{key:"onClickPlayer",value:function(){this.startFlag&&(this.zdFlage=!0,this.player.pos(Laya.stage.mouseX,Laya.stage.mouseY))}},{key:"onStageMouseMove",value:function(){this.startFlag=!0}},{key:"onStageClick",value:function(e){}}]),gameControl}(),t=function(t){function ys(){var e;return _classCallCheck(this,ys),(e=_possibleConstructorReturn(this,_getPrototypeOf(ys).call(this))).level=1,e.num=0,e.fxNum=0,e}return _inherits(ys,Laya.Script),_createClass(ys,[{key:"onEnable",value:function(){this._rig=this.owner.getComponent(Laya.RigidBody),this.fs=this.owner.parent.parent.getChildByName("fs"),this.num=2}},{key:"onUpdate",value:function(){this.owner.rotation++}},{key:"onTriggerEnter",value:function(t,a,n){var o=this.owner,i=this.owner;if("zd"===t.label)if(this.num>1){this.num--;i.loadImage("./res/ys.png");o.getComponent(Laya.RigidBody).setVelocity({x:0,y:-10})}else{var s=Laya.Pool.getItemByCreateFun("effect",this.createEffect,this);s.pos(o.x,o.y),o.parent.addChild(s),s.play(0,!0),o.removeSelf(),console.log(this.fs);var r=this.fs.getChildByName("fs_lable");e.instance.fsNum+=1,r.changeText(e.instance.fsNum+"")}else"ground"===t.label&&(o.removeSelf(),e.instance.stopGame())}},{key:"createEffect",value:function(){var e=new Laya.Animation;return e.loadAnimation("bzdx.ani"),e.on(Laya.Event.COMPLETE,null,function(){e.removeSelf(),Laya.Pool.recover("effect",e)}),e}},{key:"onDisable",value:function(){this.owner.loadImage("./res/ys1.png"),Laya.Pool.recover("dropBox",this.owner)}}]),ys}(),a=function(e){function Bullet(){return _classCallCheck(this,Bullet),_possibleConstructorReturn(this,_getPrototypeOf(Bullet).call(this))}return _inherits(Bullet,Laya.Script),_createClass(Bullet,[{key:"onEnable",value:function(){this.owner.getComponent(Laya.RigidBody).setVelocity({x:0,y:-10})}},{key:"onTriggerEnter",value:function(e,t,a){this.owner.removeSelf()}},{key:"onUpdate",value:function(){this.owner.y<-10&&this.owner.removeSelf()}},{key:"onDisable",value:function(){Laya.Pool.recover("bullet",this.owner)}}]),Bullet}(),n=function(){function GameConfig(){_classCallCheck(this,GameConfig)}return _createClass(GameConfig,null,[{key:"init",value:function(){var n=Laya.ClassUtils.regClass;n("script/gameControl.ts",e),n("script/ys.ts",t),n("script/zd.ts",a)}}]),GameConfig}();n.width=640,n.height=1136,n.scaleMode="fixedwidth",n.screenMode="none",n.alignV="top",n.alignH="left",n.startScene="main.scene",n.sceneRoot="",n.debug=!1,n.stat=!1,n.physicsDebug=!1,n.exportSceneToJson=!0,n.init(),new(function(){function Main(){_classCallCheck(this,Main),window.Laya3D?Laya3D.init(n.width,n.height):Laya.init(n.width,n.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=n.scaleMode,Laya.stage.screenMode=n.screenMode,Laya.stage.alignV=n.alignV,Laya.stage.alignH=n.alignH,Laya.URL.exportSceneToJson=n.exportSceneToJson,(n.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),n.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),n.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return _createClass(Main,[{key:"onVersionLoaded",value:function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}},{key:"onConfigLoaded",value:function(){n.startScene&&Laya.Scene.open(n.startScene)}}]),Main}())}();