var window = $global.window;
var document = window.document;
var XMLHttpRequest = window.XMLHttpRequest;
var Laya = window.Laya;
var Config = window.Config;
var Config3D = window.Config3D;
var Laya3D = window.Laya3D;
var performance = window.performance;
var CANNON = window.CANNON;
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=_superPropBase(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var e=function GlobalData(){_classCallCheck(this,GlobalData)};e.isGuide=!1,e.isInit=!0,e.gameOver=!1,e.catRunSpeeds=[.25,.3,.35,.45],e.isOpenSound=!0,e.isBaoXiang=!1;var t=function(){function PlayerPrefs(){_classCallCheck(this,PlayerPrefs)}return _createClass(PlayerPrefs,null,[{key:"GetInt",value:function(e,t){return PlayerPrefs.GetValueNum(e,t)}},{key:"SetInt",value:function(e,t){PlayerPrefs.SetValueNum(e,t)}},{key:"DeleteAll",value:function(){Laya.LocalStorage.clear()}},{key:"GetValueNum",value:function(e,t){var n=Laya.LocalStorage.getItem(e);return null==n||""==n?t:Number(n)}},{key:"SetValueNum",value:function(e,t){Laya.LocalStorage.setItem(e,t.toString())}}]),PlayerPrefs}(),n=function(e){function Time(){return _classCallCheck(this,Time),_possibleConstructorReturn(this,_getPrototypeOf(Time).apply(this,arguments))}return _inherits(Time,Laya.Script),Time}();n.fixedDeltaTime=0,n.deltaTime=0,n.time=0,n.deltaTimeMin=1e16,n.deltaTimeMax=0,n.deltaTimeEvr=0;var a=function EventType(){_classCallCheck(this,EventType)};a.ShapeThreeDEnterWorld="ShapeThreeDEnterWorld",a.AD_VIDEO_CLOSE_EVENT="AD_VIDEO_CLOSE_EVENT",a.WxOnShow="WxOnShow",a.SHARE_Ok="SHARE_Ok",a.UpdateGoldItemUi="UpdateGoldItemUi",a.ShopSelectChrater="onSelectChrater",a.ShopSelectHat="ShopSelectHat",a.CharaterIniOk="CharaterIniOk";var i=function(e){function EventManager(){return _classCallCheck(this,EventManager),_possibleConstructorReturn(this,_getPrototypeOf(EventManager).apply(this,arguments))}return _inherits(EventManager,Laya.EventDispatcher),_createClass(EventManager,null,[{key:"instance",get:function(){return null==EventManager._instance&&(EventManager._instance=new EventManager),EventManager._instance}}]),EventManager}(),o=function(){function SoundManager(){_classCallCheck(this,SoundManager),this.bgmurl="sound/main/bgm.mp3",this.bgmurl2="sound/bgm.mp3",this.clcik=new s("res/sound/main/click.mp3",0),this.FishCollection=new s("sound/FishCollection.mp3",.5),this.CatDeath=new s("sound/CatDeath.mp3",1),this.CatJump=new s("sound/CatJump.mp3",0),this.BuyOk=new s("res/sound/main/buyItem.mp3",0),this.wineffect=new s("sound/jiasu.mp3",0),this.powerUp=new s("res/sound/game/powerUp.mp3",0),this.starAward=new s("res/sound/game/starAward.mp3",0),this.startGame=new s("sound/starAward.mp3",0),this.hit=new s("sound/hit.mp3",.3),this._tbSound=Laya.Browser.window.tbSound,this._playSound=null,this._isPlaySound=!1,this._playOneShot=null,this._isPlayOneShot=!1,this._playNumSound=null,this._isplayNumSound=!1,this.prebgmurl="",this._music=null,this._musicPlay=null,this._isPlayMusic=!1,i.instance.on(a.AD_VIDEO_CLOSE_EVENT,this,this.onAD_VIDEO_CLOSE_EVENT),i.instance.on(a.WxOnShow,this,this.ReSumeBgm)}return _createClass(SoundManager,[{key:"onAD_VIDEO_CLOSE_EVENT",value:function(){this.ReSumeBgm()}},{key:"play",value:function(e){SoundManager.isPlaySound()&&(Laya.Browser.onTBMiniGame?null==this._playSound?(this._playSound=new this._tbSound.Sound,this._playSound.addEventListener(this._tbSound.Event.COMPLETE,function(e){this._isPlaySound=!0,this._playSound.play(0,1)},this),this._playSound.load(e)):this._isPlaySound&&this._playSound.play(0,1):Laya.SoundManager.playSound(e,1))}},{key:"PlayOneShot",value:function(e){SoundManager.isPlaySound()&&(Laya.Browser.onTBMiniGame?null==this._playOneShot?(this._playOneShot=new this._tbSound.Sound,this._playOneShot.addEventListener(this._tbSound.Event.COMPLETE,function(e){this._isPlayOneShot=!0,this._playOneShot.play(0,1)},this),this._playOneShot.load(e)):this._isPlayOneShot&&this._playOneShot.play(0,1):Laya.SoundManager.playSound(e,1))}},{key:"PlayByNum",value:function(e,t){SoundManager.isPlaySound()&&(Laya.Browser.onTBMiniGame?null==this._playNumSound?(this._playNumSound=new this._tbSound.Sound,this._playNumSound.addEventListener(this._tbSound.Event.COMPLETE,function(e){this._isplayNumSound=!0,this._playNumSound.play(0,1)},this),this._playNumSound.load(e)):this._isplayNumSound&&this._playNumSound.play(0,1):Laya.SoundManager.playSound(e,t))}},{key:"BgmPlay",value:function(){this.PlayBgm(this.bgmurl,!0)}},{key:"PlayGameBgm",value:function(){this.PlayBgm(this.bgmurl2,!0)}},{key:"stopBgm",value:function(){Laya.Browser.onTBMiniGame&&(console.log("===stopBgm===",this._music),this._musicPlay.volume=0)}},{key:"BgmPlaySetting",value:function(){this.PlayBgm(this.bgmurl,!0)}},{key:"ReSumeBgm",value:function(){console.log("ReSumeBgm"),(SoundManager.isPlaySound()||null==this.curbgm_SoundChannel)&&this.curbgm_SoundChannel.resume()}},{key:"pauseBgm",value:function(){null!=this.curbgm_SoundChannel&&this.curbgm_SoundChannel.pause()}},{key:"PlayBgm",value:function(e,t){if(SoundManager.isPlaySound())if(Laya.Browser.onTBMiniGame){if(!SoundManager.isPlaySound())return;if(0==this._isPlayMusic){var n=Laya.Browser.window.tbSound;this._music=new n.Sound,this._music.addEventListener(n.Event.COMPLETE,function(e){this._isPlayMusic=!0,this._musicPlay=this._music.play()},this),this._music.load(e)}else this._musicPlay.volume=1}else{this.prebgmurl!=e&&(this.curbgm_SoundChannel=null);var a=SoundManager.isPlaySound();if(console.log("isPlaySound="+a),a){console.log("PlayBgm");var i=1;if(t&&(i=0),null==this.curbgm_SoundChannel){var o=Laya.SoundManager.playMusic(e,i);this.curbgm_SoundChannel=o}else this.curbgm_SoundChannel.play()}}}}],[{key:"isPlaySound",value:function(){return e.isOpenSound}},{key:"setPlaySound",value:function(e){t.SetInt("PlaySound",e?1:0)}},{key:"instance",get:function(){return null==SoundManager.minstance&&(SoundManager.minstance=new SoundManager),SoundManager.minstance}}]),SoundManager}(),s=function(){function AudioClip(e,t){_classCallCheck(this,AudioClip),this.preTime=0,this.minRate=0,this.url=e,this.minRate=t}return _createClass(AudioClip,[{key:"Play",value:function(){n.time-this.preTime<this.minRate||(o.instance.PlayOneShot(this.url),this.preTime=n.time)}},{key:"PlayByNum",value:function(e){n.time-this.preTime<this.minRate||(o.instance.PlayByNum(this.url,e),this.preTime=n.time)}}]),AudioClip}(),r=function(){function Utils(){_classCallCheck(this,Utils)}return _createClass(Utils,[{key:"tweenShake",value:function(e,t){var n=new Laya.TimeLine,a=e.pivotX;e.pivotX=e.width/2,n.addLabel("shake1",0).to(e,{rotation:e.rotation+5},50,null,0).addLabel("shake2",0).to(e,{rotation:e.rotation-6},50,null,0).addLabel("shake3",0).to(e,{rotation:e.rotation-13},50,null,0).addLabel("shake4",0).to(e,{rotation:e.rotation+3},50,null,0).addLabel("shake5",0).to(e,{rotation:e.rotation-5},50,null,0).addLabel("shake6",0).to(e,{rotation:e.rotation+2},50,null,0).addLabel("shake7",0).to(e,{rotation:e.rotation-8},50,null,0).addLabel("shake8",0).to(e,{rotation:e.rotation+3},50,null,0).addLabel("shake9",0).to(e,{rotation:0},50,null,0),t?Laya.timer.once(500,this,function(){n.destroy(),e.rotation=0,e.pivotX=a}):n.on(Laya.Event.COMPLETE,this,function(){n.destroy(),e.rotation=0,e.pivotX=a}),n.play(0,!0)}},{key:"compareVersion",value:function(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var a=0;a<n;a++){var i=parseInt(e[a]),o=parseInt(t[a]);if(i>o)return 1;if(i<o)return-1}return 0}}],[{key:"addClickEvent",value:function(e,t,n,a){if(null!=e){e.offAllCaller(t);e.on(Laya.Event.CLICK,t,function(e){n&&n.call(t,e)});e.pivotX=.5*e.width,e.pivotY=.5*e.height,e.x+=.5*e.width,e.y+=.5*e.height;e.on(Laya.Event.MOUSE_DOWN,t,function(t){t.stopPropagation(),Laya.Tween.to(e,{scaleX:.95,scaleY:.95},60)});e.on(Laya.Event.MOUSE_UP,t,function(t){t.stopPropagation(),Laya.Tween.to(e,{scaleX:1,scaleY:1},60)});e.on(Laya.Event.MOUSE_OUT,t,function(t){t.stopPropagation(),Laya.Tween.to(e,{scaleX:1,scaleY:1},60)})}}},{key:"addClickEventScale",value:function(e,t,n,a,i){if(null!=e){e.offAllCaller(t);e.on(Laya.Event.CLICK,t,function(e){n&&n.call(t,e)});e.pivotX=.5*e.width,e.pivotY=.5*e.height,e.x+=.5*e.width,e.y+=.5*e.height;e.on(Laya.Event.MOUSE_DOWN,t,function(t){t.stopPropagation(),Laya.Tween.to(e,{scaleX:a-.05,scaleY:a-.05},60)});e.on(Laya.Event.MOUSE_UP,t,function(t){t.stopPropagation(),Laya.Tween.to(e,{scaleX:a,scaleY:a},60)});e.on(Laya.Event.MOUSE_OUT,t,function(t){t.stopPropagation(),Laya.Tween.to(e,{scaleX:a,scaleY:a},60)})}}}]),Utils}(),l=function(e){function SoundBtn(){return _classCallCheck(this,SoundBtn),_possibleConstructorReturn(this,_getPrototypeOf(SoundBtn).apply(this,arguments))}return _inherits(SoundBtn,Laya.Image),_createClass(SoundBtn,[{key:"onAwake",value:function(){this.skin=o.isPlaySound()?"Textrue/btn_sound_on.png":"Textrue/btn_sound_off.png",r.addClickEvent(this,this,this.OnClick)}},{key:"OnClick",value:function(){var e=!o.isPlaySound();o.setPlaySound(e),this.skin=e?"Textrue/btn_sound_on.png":"Textrue/btn_sound_off.png",e?o.instance.BgmPlaySetting():o.instance.pauseBgm()}}]),SoundBtn}(),u=function(){function Platform(){_classCallCheck(this,Platform)}return _createClass(Platform,null,[{key:"supportSubPackage",value:function(){return this.commonData.onplatformTT?(console.log("不支持分包"),!1):this.commonData.onplatformWX?(console.log("onplatformWX"),!0):!!Laya.Browser.onVVMiniGame||!Laya.Browser.onQGMiniGame&&!!Laya.Browser.onQQMiniGame}},{key:"loadSubpackage_Single",value:function(e,t,n){if(this.commonData.onplatformTT)console.error("不支持分包");else if(Laya.Browser.onMiniGame){return wx.loadSubpackage({name:e,success:function(a){console.log(e+" 分包加载成功"),n.apply(t,[!0])},fail:function(a){console.error(e+"分包加载失败"),n.apply(t,[!1])}})}}},{key:"isPlayVibrate",value:function(){return 1==t.GetInt("Vibrate",1)}},{key:"setPlayVibrate",value:function(e){t.SetInt("Vibrate",e?1:0)}},{key:"vibrateLong",value:function(){if(Platform.isPlayVibrate())if(this.commonData.onplatformWX){window.wx.vibrateLong({success:function(){},fail:function(){},complete:function(){}})}else if(this.commonData.onplatformTT)this.commonData.windowTT.vibrateLong({success:function(e){console.log("".concat(e))},fail:function(e){console.log("vibrateLong调用失败")}});else if(Laya.Browser.onQGMiniGame||Laya.Browser.onVVMiniGame){qg.vibrateLong({success:function(){},fail:function(){},complete:function(){}}),console.log("qg.vibrateLong")}else if(Laya.Browser.onQQMiniGame){window.qq.vibrateLong({success:function(){},fail:function(){},complete:function(){}})}else{if(null==Laya.Browser.window.qg)return;if(null==Laya.Browser.window.qg.vibrateLong)return;qg.vibrateLong({success:function(){},fail:function(){},complete:function(){}})}}},{key:"showToast",value:function(e){if(!this.commonData.OnPc)if(this.commonData.onplatformTT)this.commonData.windowTT.showToast({title:e,duration:2e3,success:function(e){},fail:function(e){}});else if(this.commonData.onplatformWX){var t={title:e,icon:"",image:"",duration:1500,success:function(){},fail:function(){},complete:function(){},mask:!1};qg.showToast(t)}else if(Laya.Browser.onVVMiniGame){var n={title:e,icon:"",image:"",duration:1500,success:function(){},fail:function(){},complete:function(){},mask:!1};window.qg.showToast(n)}else if(Laya.Browser.onQGMiniGame){console.log("oppo showToast",e);var a={title:e,icon:"",image:"",duration:1500,success:function(){},fail:function(){},complete:function(){},mask:!1};window.qg.showToast(a)}}}]),Platform}();u.commonData=new function PlatformData(){_classCallCheck(this,PlatformData),this.devtools=!1,this.onplatformTT=!1,this.onplatformWX=!1,this.OnIOS=!1,this.OnPc=!1,this.OnAndroid=!1,this.launchOptions={}};var c=function(e){function VibrateBtn(){return _classCallCheck(this,VibrateBtn),_possibleConstructorReturn(this,_getPrototypeOf(VibrateBtn).apply(this,arguments))}return _inherits(VibrateBtn,Laya.Image),_createClass(VibrateBtn,[{key:"onAwake",value:function(){this.skin=u.isPlayVibrate()?"Textrue/btn_vibrate_on.png":"Textrue/btn_vibrate_off.png",r.addClickEvent(this,this,this.OnClick)}},{key:"OnClick",value:function(){var e=!u.isPlayVibrate();u.setPlayVibrate(e),this.skin=e?"Textrue/btn_vibrate_on.png":"Textrue/btn_vibrate_off.png",console.log("Vibrate",e)}}]),VibrateBtn}(),h=function(){function GameConfig(){_classCallCheck(this,GameConfig)}return _createClass(GameConfig,null,[{key:"init",value:function(){var e=Laya.ClassUtils.regClass;e("game/scripts/component/button/Soundbtn.ts",l),e("game/scripts/component/button/VibrateBtn.ts",c)}}]),GameConfig}();h.width=750,h.height=1334,h.scaleMode="fixedwidth",h.screenMode="none",h.alignV="top",h.alignH="left",h.startScene="views/game.scene",h.sceneRoot="",h.debug=!1,h.stat=!1,h.physicsDebug=!1,h.exportSceneToJson=!0,h.init();var d,y=function(e){function Layer(e){var t;return _classCallCheck(this,Layer),(t=_possibleConstructorReturn(this,_getPrototypeOf(Layer).call(this)))._type=e,t.init(),t}return _inherits(Layer,Laya.Sprite),_createClass(Layer,[{key:"init",value:function(){}},{key:"destroy",value:function(){_get(_getPrototypeOf(Layer.prototype),"destroy",this).call(this)}},{key:"type",get:function(){return this._type}}]),Layer}();!function(e){e[e.Scene3D=0]="Scene3D",e[e.UI=1]="UI",e[e.Tip=2]="Tip"}(d||(d={}));var f=function(e){function Scene3DLayer(){return _classCallCheck(this,Scene3DLayer),_possibleConstructorReturn(this,_getPrototypeOf(Scene3DLayer).call(this,d.Scene3D))}return _inherits(Scene3DLayer,y),Scene3DLayer}(),m=function(e){function TipsLayer(){var e;return _classCallCheck(this,TipsLayer),(e=_possibleConstructorReturn(this,_getPrototypeOf(TipsLayer).call(this,d.Tip))).init(),e}return _inherits(TipsLayer,y),_createClass(TipsLayer,[{key:"init",value:function(){this.width=Laya.stage.width,this.height=Laya.stage.height}}]),TipsLayer}(),p=function(e){function UILayer(){var e;return _classCallCheck(this,UILayer),(e=_possibleConstructorReturn(this,_getPrototypeOf(UILayer).call(this,d.UI))).init(),e}return _inherits(UILayer,y),_createClass(UILayer,[{key:"init",value:function(){this.width=Laya.stage.width,this.height=Laya.stage.height}}]),UILayer}(),v=function(){function Dictionary(){_classCallCheck(this,Dictionary),this._keys=null,this._values=null,this._keys=new Array,this._values=new Array}return _createClass(Dictionary,[{key:"destroy",value:function(){}},{key:"setValue",value:function(e,t){var n=this.indexOf(e);n>=0?this._values[n]=t:(this._keys.push(e),this._values.push(t))}},{key:"indexOf",value:function(e){return this._keys.indexOf(e)}},{key:"containsKey",value:function(e){return-1!=this._keys.indexOf(e)}},{key:"getValue",value:function(e){var t=this.indexOf(e);return t<0?null:this._values[t]}},{key:"remove",value:function(e){var t=this.indexOf(e);return t>=0&&(this._keys.splice(t,1),this._values.splice(t,1),!0)}},{key:"clear",value:function(){this._values.splice(0,this._values.length),this._keys.splice(0,this._keys.length)}},{key:"forEach",value:function(e){for(var t=0;t<this._keys.length;t++){if(!1===e(this._keys[t],this._values[t]))return}}},{key:"isEmpty",value:function(){return this._values.length<=0}},{key:"values",get:function(){return this._values}},{key:"keys",get:function(){return this._keys}},{key:"length",get:function(){return this._values.length}}]),Dictionary}(),g=function(){function Log(){_classCallCheck(this,Log)}return _createClass(Log,null,[{key:"log",value:function(){if(0!=this.enable){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log(this.group,t)}}},{key:"Enable",set:function(e){this.enable=e}}]),Log}();g.enable=!0,g.group="KuPaoGameDebug------\x3e";var _=function(){function LayerManager(){_classCallCheck(this,LayerManager),this._layerDic=new v}return _createClass(LayerManager,[{key:"destory",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this._layerDic.values[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;o.removeSelf(),o.destroy()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this._layerDic=null}},{key:"addLayer",value:function(e){var t=this.getExistLayer(e);return null==t?((t=new e).name=e.prototype.constructor.name,this._layerDic.setValue(e,t),Laya.stage.addChild(t)):g.log("该图层已经添加，请检查:",e.prototype.name),t}},{key:"getExistLayer",value:function(e){var t=this._layerDic.indexOf(e);return t>=0?this._layerDic.values[t]:null}},{key:"getLayer",value:function(e){return this.getExistLayer(e)}},{key:"addScene",value:function(e,t){var n=this.getExistLayer(t);if(!n)throw new Error("该层级未创建");return n.addChild(e),e}},{key:"removeScene",value:function(e,t){if(!this.getExistLayer(t))throw new Error("该层级未创建");return e.removeSelf(),e}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new LayerManager),this._instance}}]),LayerManager}();_._instance=null;var w=function(){function ModuleManager(){_classCallCheck(this,ModuleManager),this._modules=null,this._modules=new v}return _createClass(ModuleManager,[{key:"initialize",value:function(){this._modules.values.forEach(function(e){e.initialize()})}},{key:"uninitialize",value:function(){this._modules.values.forEach(function(e){e.uninitialize()})}},{key:"addModule",value:function(e){if(null!=this._modules){if(this._modules.indexOf(e)>-1)throw"重复添加模块："+e.prototype.constructor.name;this._modules.setValue(e,new e)}}},{key:"getModule",value:function(e){if(null!=this._modules)return this._modules.getValue(e)}},{key:"removeModule",value:function(e){if(null!=this._modules){var t=this.getModule(e);t?this._modules.remove(e):g.log("该模块不存在："+e.prototype.constructor.name)}}},{key:"removeAllModule",value:function(){var e=this;this._modules.length>0&&this._modules.forEach(function(t,n){e.removeModule(t)})}},{key:"destroy",value:function(){this._modules.clear(),this._modules=null}}]),ModuleManager}(),C=function(){function BaseModule(){_classCallCheck(this,BaseModule),this._model=null,this._view=null,this._callBack=null}return _createClass(BaseModule,[{key:"initialize",value:function(){this.addModel(),this.addView(),this._model&&this._model.regist()}},{key:"uninitialize",value:function(){this._model&&(this._model.destory(),this._model=null),this._view&&(this._view.destroy(),this._view=null)}},{key:"addModel",value:function(){g.log("子类如果有数据需要重写")}},{key:"addView",value:function(){g.log("子类如果有UI需要重写")}},{key:"openWindow",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t&&(this._callBack=t),!this._view)throw"该模块UI未初始化，请实现AddView函数";this._view.openView(function(){e.open()}),null!=this._callBack&&this._callBack()}},{key:"open",value:function(){g.log("此函数是UI加载完成的回调,如果想调用控件，一定是从这个开始初始化")}},{key:"closeWindow",value:function(e){this._view&&this._view.closeView(e)}},{key:"model",get:function(){return this._model}}]),BaseModule}(),k=function(){function TweenManager(){_classCallCheck(this,TweenManager),this.targets=[],this.dic=new v}return _createClass(TweenManager,[{key:"toAlpha",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;function alpha1(){var i=a?new Laya.Handler(this,alpha2):null;Laya.Tween.to(e,{alpha:t},n,null,i)}function alpha2(){Laya.Tween.to(e,{alpha:1},n,null,Laya.Handler.create(this,alpha1))}this.saveTarget(e),e.alpha=i,alpha1()}},{key:"toScale",value:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;function scale1(){var t=i||a?new Laya.Handler(this,scale2):null;Laya.Tween.to(e,{scaleX:o,scaleY:o},n,null,t)}function scale2(){var t=i?new Laya.Handler(this,scale1):null;Laya.Tween.to(e,{scaleX:1,scaleY:1},n,null,t)}this.saveTarget(e),e.scaleX=1,e.scaleY=1,scale1()}},{key:"toScale_Jie",value:function(e,t,n,a,i,o,s,r){this.saveTarget(e),Laya.Tween.to(e,{scaleX:t,scaleY:n},o,r),Laya.Tween.to(e,{scaleX:a,scaleY:i},s,r,null,o)}},{key:"toTop",value:function(e,t,n,a){this.saveTarget(e),Laya.Tween.to(e,{top:t},n,a)}},{key:"toPosition",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.saveTarget(e);var o=new Laya.Vector2(e.x,e.y);function pos1(){if(a)switch(i){case 0:var o=new Laya.Handler(this,pos2);break;case 1:o=new Laya.Handler(this,pos3)}Laya.Tween.to(e,{x:t.x,y:t.y},n,null,o)}function pos2(){Laya.Tween.to(e,{x:o.x,y:o.y},n,null,Laya.Handler.create(this,pos1))}function pos3(){e.x=o.x,e.y=o.y,pos1()}pos1()}},{key:"toPositionEase",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.saveTarget(e);var s=new Laya.Vector2(e.x,e.y);function pos1(){if(a)switch(o){case 0:var s=new Laya.Handler(this,pos2);break;case 1:s=new Laya.Handler(this,pos3)}Laya.Tween.to(e,{x:t.x,y:t.y},n,i,s)}function pos2(){Laya.Tween.to(e,{x:s.x,y:s.y},n,null,Laya.Handler.create(this,pos1))}function pos3(){e.x=s.x,e.y=s.y,pos1()}pos1()}},{key:"toPositionRePlay",value:function(e,t,n){this.saveTarget(e);var a=new Laya.Vector2(e.x,e.y);!function pos1(){e.x=a.x;e.y=a.y;var i=new Laya.Handler(this,pos1);Laya.Tween.to(e,{x:t.x,y:t.y},n,null,i)}()}},{key:"toPositionRePlayEase",value:function(e,t,n,a){this.saveTarget(e);var i=new Laya.Vector2(e.x,e.y);!function pos1(){e.x=i.x;e.y=i.y;var o=new Laya.Handler(this,pos1);Laya.Tween.to(e,{x:t.x,y:t.y},n,a,o)}()}},{key:"fromAlpha",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];function alpha1(){var i=a?new Laya.Handler(this,alpha2):null;Laya.Tween.from(e,{alpha:t},n,null,i)}function alpha2(){Laya.Tween.from(e,{alpha:1},n,null,Laya.Handler.create(this,alpha1))}this.saveTarget(e),e.alpha=1,alpha1()}},{key:"fromScale",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];function scale1(){var i=a?new Laya.Handler(this,scale2):null;Laya.Tween.from(e,{scaleX:t,scaleY:t},n,null,i)}function scale2(){Laya.Tween.from(e,{scaleX:1,scaleY:1},n,null,Laya.Handler.create(this,scale1))}this.saveTarget(e),scale1()}},{key:"numberAnim",value:function(e,t,n,a,i){var o={};o.value=e,Laya.Tween.to(o,{value:t},n).update=new Laya.Handler(this,function(){a.call(o.value,i)})}},{key:"saveTarget",value:function(e){var t=this.dic.getValue(e.scene.url);t?t.push(e):((t=[]).push(e),this.dic.setValue(e.scene.url,t))}},{key:"clearAll",value:function(e){var t=this.dic.getValue(e.scene.url);t&&(t.forEach(function(e){Laya.Tween.clearAll(e)}),t=[])}},{key:"toScaleExt",value:function(e,t,n,a,i,o,s){function scale1(){var t=s?new Laya.Handler(this,scale2):null;Laya.Tween.to(e,{scaleX:a,scaleY:i},o,Laya.Ease.linearOut,t)}function scale2(){var t=s?new Laya.Handler(this,scale1):null;Laya.Tween.to(e,{scaleX:1,scaleY:1},o,Laya.Ease.linearOut,t)}this.saveTarget(e),e.scaleX=t,e.scaleY=n,scale1()}},{key:"toPositionExt",value:function(e,t,n){this.saveTarget(e),Laya.Tween.to(e,{x:t.x,y:t.y},n,Laya.Ease.linearOut)}},{key:"toPositionPingPongOnece",value:function(e,t,n){this.saveTarget(e),Laya.Tween.clearTween(e);var a=new Laya.Vector2(e.x,e.y),i=new Laya.Handler(this,function(){Laya.Tween.to(e,{x:a.x,t:a.y},n,Laya.Ease.linearOut,null)});Laya.Tween.to(e,{x:t.x,y:t.y},n,Laya.Ease.linearOut,i)}},{key:"toPosition_PingPong_Onece_delay",value:function(e,t,n,a){this.saveTarget(e),Laya.Tween.clearTween(e);var i=new Laya.Vector2(e.x,e.y),o=new Laya.Handler(this,function(){Laya.Tween.to(e,{x:i.x,t:i.y},n,Laya.Ease.quadInOut,null,a)});Laya.Tween.to(e,{x:t.x,y:t.y},n,Laya.Ease.quartIn,o)}},{key:"toPosition__Box_PingPong_Onece_delay",value:function(e,t,n,a){this.saveTarget(e),Laya.Tween.clearTween(e);var i=e.right,o=new Laya.Handler(this,function(){Laya.Tween.to(e,{right:i},n,Laya.Ease.quadInOut,null,a)});Laya.Tween.to(e,{right:t},n,Laya.Ease.quartIn,o)}},{key:"toScaleRePlay",value:function(e,t,n){this.saveTarget(e);var a=new Laya.Vector2(e.scaleX,e.scaleY);!function pos1(){e.scaleX=a.x;e.scaleY=a.y;var i=new Laya.Handler(this,pos1);Laya.Tween.to(e,{scaleX:t.x,scaleY:t.y},n,null,i)}()}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new TweenManager),this._instance}}]),TweenManager}(),L=function DataChangeEvent(){_classCallCheck(this,DataChangeEvent)};L.SCORE_CHANGE="ScoreChange",L.FISH_COUNT_CHANGE="FishCountChange";var S=function CallBackRegisiter(){_classCallCheck(this,CallBackRegisiter)},b=function GameDesgin(){_classCallCheck(this,GameDesgin)};b.showaabbBoxLine=!1,b.enableCollsion=!0,b.logFps=!1,b.spwanFish=!0,b.spwanObstacle=!0;var P=function(e){function CollsionManagerThreeD(){var e;return _classCallCheck(this,CollsionManagerThreeD),(e=_possibleConstructorReturn(this,_getPrototypeOf(CollsionManagerThreeD).call(this))).detectObjs=[],e.Itemlist=[],e.enterList=[],e.exitList=[],e.datacg={},e.filerZList=[],e}return _inherits(CollsionManagerThreeD,Laya.Script),_createClass(CollsionManagerThreeD,[{key:"onAwake",value:function(){CollsionManagerThreeD.instantce=this,i.instance.on(a.ShapeThreeDEnterWorld,this,this.OnShapeThreeDEnterWorld)}},{key:"OnShapeThreeDEnterWorld",value:function(e){this.Itemlist.push(e),this.UpdateDetectMap()}},{key:"SetDetectObj",value:function(e){this.detectObjs.push(e),this.UpdateDetectMap()}},{key:"UpdateDetectMap",value:function(){for(var e=0;e<this.detectObjs.length;e++)for(var t=0;t<this.Itemlist.length;t++){var n=this.Itemlist[t];null==this.detectObjs[e].detectmap[n.id]&&(this.detectObjs[e].detectmap[n.id]=!1)}}},{key:"onLateUpdate",value:function(){if(b.enableCollsion&&this.detectObjs.length>=1)for(var e=0;e<this.detectObjs.length;e++){var t=this.detectObjs[e];this.GetFilterZItems(this.detectObjs[e].transform.position.z,t),this.Detect(t,t.moveSpeed)}}},{key:"Detect",value:function(e,t){for(var n=e,a=0;a<this.filerZList.length;a++){var i=this.filerZList[a],o=(e.collisionMask&1<<i.mask)>0;if(e.id!=i.id&&o){var s=i.id,r=i;e.detectmap[s]&&1;new Laya.Vector3;if(n.Intersects(r)){0==e.detectmap[s]&&(e.TriggerEnterEvent(e,i),e.detectmap[s]=!0)}else e.detectmap[s]&&(e.TriggerExitEvent(e,i),e.detectmap[s]=!1)}}}},{key:"GetFilterZItems",value:function(e,t){this.filerZList=[];for(var n=0;n<this.Itemlist.length;n++){var a=this.Itemlist[n];0!=a.gameObject.displayedInStage&&(0!=a.gameObject.activeInHierarchy&&a.gameObject.id!=t.gameObject.id&&(Math.abs(e-a.transform.position.z)>20||this.filerZList.push(this.Itemlist[n])))}}},{key:"IsSweepTestCollision",value:function(e,t,n){var a,i,o=n.x,s=n.y,r=n.z;if(e.maxPoint.y>t.minPoint.y&&e.minPoint.y<t.maxPoint.y&&e.maxPoint.z>t.minPoint.z&&e.minPoint.z<t.maxPoint.z){var l=0;if(o>0&&e.maxPoint.x<=t.minPoint.x){if((l=t.minPoint.x-e.maxPoint.x)<o)return o=l,!0}else if(o<0&&e.minPoint.x>=t.maxPoint.x&&(l=t.maxPoint.x-e.minPoint.x)>o)return o=l,!0}if(e.maxPoint.x>t.minPoint.x&&e.minPoint.x<t.maxPoint.x&&e.maxPoint.z>t.minPoint.z&&e.minPoint.z<t.maxPoint.z)if(s>0&&e.maxPoint.y<=t.minPoint.y){if((a=t.minPoint.y-e.maxPoint.y)<s)return s=a,!0}else if(s<0&&e.minPoint.y>=t.maxPoint.y&&(a=t.maxPoint.y-e.minPoint.y)>s)return s=a,!0;if(e.maxPoint.x>t.minPoint.x&&e.minPoint.x<t.maxPoint.x&&e.maxPoint.y>t.minPoint.y&&e.minPoint.y<t.maxPoint.y)if(r>0&&e.maxPoint.z<=t.minPoint.z){if((i=t.minPoint.z-e.maxPoint.z)<r)return r=i,!0}else if(r<0&&e.minPoint.z>=t.maxPoint.z&&(i=t.maxPoint.z-e.minPoint.z)>r)return r=i,!0;return!1}},{key:"SweepTestCollision",value:function(e,t,n){var a,i,o=n.x,s=n.y,r=n.z;if(e.maxPoint.y>t.minPoint.y&&e.minPoint.y<t.maxPoint.y&&e.maxPoint.z>t.minPoint.z&&e.minPoint.z<t.maxPoint.z){var l=0;o>0&&e.maxPoint.x<=t.minPoint.x?(l=t.minPoint.x-e.maxPoint.x)<o&&(o=l):o<0&&e.minPoint.x>=t.maxPoint.x&&(l=t.maxPoint.x-e.minPoint.x)>o&&(o=l)}e.maxPoint.x>t.minPoint.x&&e.minPoint.x<t.maxPoint.x&&e.maxPoint.z>t.minPoint.z&&e.minPoint.z<t.maxPoint.z&&(s>0&&e.maxPoint.y<=t.minPoint.y?(a=t.minPoint.y-e.maxPoint.y)<s&&(s=a):s<0&&e.minPoint.y>=t.maxPoint.y&&(a=t.maxPoint.y-e.minPoint.y)>s&&(s=a));e.maxPoint.x>t.minPoint.x&&e.minPoint.x<t.maxPoint.x&&e.maxPoint.y>t.minPoint.y&&e.minPoint.y<t.maxPoint.y&&(r>0&&e.maxPoint.z<=t.minPoint.z?(i=t.minPoint.z-e.maxPoint.z)<r&&(r=i):r<0&&e.minPoint.z>=t.maxPoint.z&&(i=t.maxPoint.z-e.minPoint.z)>r&&(r=i));return new Laya.Vector3(o,s,r)}}]),CollsionManagerThreeD}(),O=function CollisionMask(){_classCallCheck(this,CollisionMask)};O.Character=1,O.Obstacle=2,O.Fish=3,O.Award=4,O.Gold=5,O.PaoDao=6,O.HuaPo=7,O.JiaSu=8,O.End=9;var x=function(e){function ShapeThreeD(){var e;return _classCallCheck(this,ShapeThreeD),(e=_possibleConstructorReturn(this,_getPrototypeOf(ShapeThreeD).call(this))).collisionEnter=[],e.collisionExit=[],e.collisionRayHit=[],e.mask=0,e.detectmap={},e.collisionMask=-1,e.moveSpeed=new Laya.Vector3(0,0,0),e}return _inherits(ShapeThreeD,Laya.Script3D),_createClass(ShapeThreeD,[{key:"SetMask",value:function(e){this.mask=e}},{key:"onAwake",value:function(){this.gameObject=this.owner,this.transform=this.gameObject.transform}},{key:"onStart",value:function(){i.instance.event(a.ShapeThreeDEnterWorld,this)}},{key:"onDestroy",value:function(){i.instance.event(a.ShapeThreeDEnterWorld,this)}},{key:"RegisetCollsionEnter",value:function(e,t){var n=new S;n.regisiter=e,n.enterCallbackFunc=t,this.collisionEnter.push(n)}},{key:"RegisetCollsionExit",value:function(e,t){var n=new S;n.regisiter=e,n.enterCallbackFunc=t,this.collisionExit.push(n)}},{key:"TriggerEnterEvent",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=this.collisionEnter[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var r=o.value,l=r.regisiter;r.enterCallbackFunc.apply(l,[e,t])}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"TriggerExitEvent",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=this.collisionExit[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var r=o.value,l=r.regisiter;r.enterCallbackFunc.apply(l,[e,t])}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}}},{key:"RegisetRayHitEnter",value:function(e){this.collisionRayHit.push(e)}},{key:"OnShapeRayHit",value:function(e){var t=!0,n=!1,a=void 0;try{for(var i,o=this.collisionRayHit[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value,r=s.regisiter;s.enterCallbackFunc.apply(r,[e])}}catch(e){n=!0,a=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}},{key:"ActiveDetec",value:function(){P.instantce.SetDetectObj(this)}}]),ShapeThreeD}(),M=function(){function SceneManager(){_classCallCheck(this,SceneManager)}return _createClass(SceneManager,null,[{key:"OnLoadLevelok",value:function(e,t,n,a){console.log("OnLoadLevelok ",e),n.call(t,a)}},{key:"LoadSceneByNameAtAsset",value:function(e,t,n){var a="res3d/"+e+".ls";Laya.Scene3D.load(a,Laya.Handler.create(SceneManager,SceneManager.OnLoadLevelok,[a,t,n]),null)}}]),SceneManager}();M.example_animatorUrl="res3d/LayaScene_Example_Animator/Conventional/Example_Animator.ls";var I=function(){function GameObject(e){_classCallCheck(this,GameObject),this.node=e,this.sprite3d=e}return _createClass(GameObject,[{key:"Clone_sprite3d",value:function(){return Laya.Sprite3D.instantiate(this.sprite3d)}}],[{key:"getFullPath",value:function(e){if(null!=e){var t=[];t.push(e.name);var n=e;if(null!=n)for(;null!=n.parent;)n=n.parent,t.push(n.name);for(var a="",i=t.length-1;i>=0;i--)a+=t[i]+"/";console.log(a)}else console.error("You must select Obj first!")}},{key:"GetChilds",value:function(e,t){for(var n=[],a=0;a<e.numChildren;a++){var i=e.getChildAt(a);i.name==t&&n.push(i)}return n}},{key:"GetChildsByDeth",value:function(e,t){for(var n=GameObject.getAllChilds(e),a=[],i=0;i<n.length;i++){var o=n[i];o.name==t&&a.push(o)}return a}},{key:"Find",value:function(e,t){for(var n=t.split("/"),a=e.getChildByName(n[0]),i=1;i<n.length;i++)a=a.getChildByName(n[i]);return a}},{key:"FindChilds",value:function(e,t){for(var n=[],a=0;a<t.numChildren;a++){var i=t.getChildAt(a);e==i.name&&n.push(i)}return n}},{key:"Instantiate",value:function(e){return Laya.Sprite3D.instantiate(e.sprite3d)}},{key:"Instantiate2Scene",value:function(e,t){var n=Laya.Sprite3D.instantiate(e);return t.addChild(n),n}},{key:"Instantiate2Scene_Particle3d",value:function(e,t){var n=e.clone();return t.addChild(n),n}},{key:"Instantiate2SceneUseScene",value:function(e,t){var n=Laya.Sprite3D.instantiate(e);return t.addChild(n),n}},{key:"InstantiateGob",value:function(e){return null==e?null:Laya.Sprite3D.instantiate(e)}},{key:"Add2Scene",value:function(e,t){t.addChild(e)}},{key:"InstantiateNoScene",value:function(e){return Laya.Sprite3D.instantiate(e)}},{key:"GetTypeInChildren",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=e._children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var r=o.value;if(r instanceof t)return r}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return null}},{key:"GetTypesInChildren",value:function(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var s,r=e._children[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var l=s.value;l instanceof t&&n.push(l)}}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return n}},{key:"FindUseNode",value:function(e,t){var n=e.split("/");if(null==n||0==n.length)return t.getChildByName(e);for(var a=t.getChildByName(n[0]),i=1;i<n.length;i++)a=a.getChildByName(n[i]);return a}},{key:"FindUseNodeNoDeth",value:function(e,t){return t.getChildByName(e)}},{key:"FindChildAtUseNode",value:function(e,t){return t.getChildAt(e)}},{key:"getChildAttUseNode",value:function(e,t){return t.getChildAt(e)}},{key:"GetComponentsInChildren",value:function(e,t){if(null==e)return null;var n=GameObject.getChildsDeth(e),a=[],i=!0,o=!1,s=void 0;try{for(var r,l=n[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;u instanceof t&&a.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return a}},{key:"GetComponentsInChildrenU3d",value:function(e,t){if(null==e)return null;var n=GameObject.getChildsDeth(e),a=[],i=!0,o=!1,s=void 0;try{for(var r,l=n[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value.getComponent(t);null!=u&&a.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return a}},{key:"FindChilds_deth",value:function(e,t){if(null==e)return null;var n=GameObject.getChildsDeth(e),a=[],i=!0,o=!1,s=void 0;try{for(var r,l=n[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;u.name==t&&a.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return a}},{key:"getAllChilds",value:function(e){for(var t=[],n=[],a=0;a<e.numChildren;a++)n.push(e.getChildAt(a));for(var i=0,o=n;i<o.length;i++){var s=o[i];t.push(s)}for(var r=0;r<n.length;r++){var l=this.getAllChilds(n[r]),u=!0,c=!1,h=void 0;try{for(var d,y=l[Symbol.iterator]();!(u=(d=y.next()).done);u=!0){var f=d.value;t.push(f)}}catch(e){c=!0,h=e}finally{try{u||null==y.return||y.return()}finally{if(c)throw h}}}return t}},{key:"getChildsByNameDeth",value:function(e,t){var n=[],a=GameObject.getAllChilds(e),i=!0,o=!1,s=void 0;try{for(var r,l=a[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;u.name==t&&n.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return n}},{key:"getChildsDeth",value:function(e){var t=[],n=GameObject.getAllChilds(e),a=!0,i=!1,o=void 0;try{for(var s,r=n[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var l=s.value;t.push(l)}}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return t}}]),GameObject}(),D=function(e){function PathLineDrawer(){return _classCallCheck(this,PathLineDrawer),_possibleConstructorReturn(this,_getPrototypeOf(PathLineDrawer).call(this))}return _inherits(PathLineDrawer,Laya.Script),_createClass(PathLineDrawer,[{key:"onAwake",value:function(){this.phasorSpriter3D=new Laya.PixelLineSprite3D(10,"my")}},{key:"onEnable",value:function(){}},{key:"onStart",value:function(){I.Add2Scene(this.phasorSpriter3D,M.game)}},{key:"onUpdate",value:function(){}},{key:"onDisable",value:function(){}},{key:"OnDrawGizmos",value:function(){this.phasorSpriter3D.clear(),this.phasorSpriter3D.addLine(this.start,this.end,Laya.Color.RED,Laya.Color.RED)}},{key:"clear",value:function(){this.phasorSpriter3D.clear()}},{key:"addLine",value:function(e,t){this.phasorSpriter3D.addLine(e,t,Laya.Color.RED,Laya.Color.RED)}}]),PathLineDrawer}(),T=function(){function Mathf(){_classCallCheck(this,Mathf)}return _createClass(Mathf,null,[{key:"Sin",value:function(e){return Math.sin(e)}},{key:"Abs",value:function(e){return Math.abs(e)}},{key:"Cos",value:function(e){return Math.cos(e)}},{key:"LerpAngle",value:function(e,t,n){var a=Mathf.Repeat(t-e,360);return a>180&&(a-=360),e+a*Mathf.Clamp01(n)}},{key:"Repeat",value:function(e,t){return e-Mathf.Floor(e/t)*t}},{key:"Floor",value:function(e){return Math.floor(e)}},{key:"Clamp01",value:function(e){return e<0?0:e>1?1:e}},{key:"Acos",value:function(e){return Math.acos(e)}},{key:"Atan2",value:function(e,t){return Math.atan2(e,t)}},{key:"Lerp",value:function(e,t,n){return e+(t-e)*Mathf.Clamp01(n)}},{key:"InverseLerp",value:function(e,t,n){return e!=t?Mathf.Clamp01((n-e)/(t-e)):0}},{key:"Max",value:function(e,t){return e>t?e:t}},{key:"Min",value:function(e,t){return e<t?e:t}},{key:"Clamp",value:function(e,t,n){return e<t?e=t:e>n&&(e=n),e}},{key:"PingPong",value:function(e,t){return e=this.Repeat(e,2*t),t-Mathf.Abs(e-t)}}]),Mathf}();T.Deg2Rad=.0174532924,T.Rad2Deg=57.29578,T.PI=3.14159274;var V=function(){function Vector3Ext(){_classCallCheck(this,Vector3Ext)}return _createClass(Vector3Ext,null,[{key:"normalize",value:function(e){Laya.Vector3.normalize(e,e)}},{key:"mul_Num",value:function(e,t){return new Laya.Vector3(e.x*t,e.y*t,e.z*t)}},{key:"mul_Num_Fast",value:function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t}},{key:"mul_Num_gc",value:function(e,t,n){n.x=e.x*t,n.y=e.y*t,n.z=e.z*t}},{key:"mul",value:function(e,t){var n=new Laya.Vector3;return Laya.Vector3.multiply(e,t,n),n}},{key:"add",value:function(e,t){var n=new Laya.Vector3;return Laya.Vector3.add(e,t,n),n}},{key:"add_Fast",value:function(e,t,n){Laya.Vector3.add(e,t,n)}},{key:"sub",value:function(e,t){var n=new Laya.Vector3;return Laya.Vector3.subtract(e,t,n),n}},{key:"sub_Fast",value:function(e,t,n){Laya.Vector3.subtract(e,t,n)}},{key:"Lerp_u3d",value:function(e,t,n){return n=T.Clamp01(n),new Laya.Vector3(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)}},{key:"Lerp",value:function(e,t,n){return n=T.Clamp01(n),new Laya.Vector3(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n,e.z+(t.z-e.z)*n)}},{key:"Lerp_Fast",value:function(e,t,n,a){a=T.Clamp01(a),n.x=e.x+(t.x-e.x)*a,n.y=e.y+(t.y-e.y)*a,n.z=e.z+(t.z-e.z)*a}}]),Vector3Ext}();V.Up=new Laya.Vector3(0,1,0),V.up=new Laya.Vector3(0,1,0),V.Zero=new Laya.Vector3(0,0,0),V.zero=new Laya.Vector3(0,0,0),V.forward=new Laya.Vector3(0,0,-1),V.forwardU3d=new Laya.Vector3(0,0,1),V.down=new Laya.Vector3(0,-1,0),V.one=new Laya.Vector3(1,1,1),V.left=new Laya.Vector3(-1,0,0),V.right=new Laya.Vector3(1,0,0);var A=function(e){function AABBShape(){var e;return _classCallCheck(this,AABBShape),(e=_possibleConstructorReturn(this,_getPrototypeOf(AABBShape).call(this))).drawAABBLine=!1,e.minPoint=new Laya.Vector3,e.maxPoint=new Laya.Vector3,e.halfSize=new Laya.Vector3,e.center=new Laya.Vector3,e._center=new Laya.Vector3,e}return _inherits(AABBShape,x),_createClass(AABBShape,[{key:"onStart",value:function(){_get(_getPrototypeOf(AABBShape.prototype),"onStart",this).call(this)}},{key:"onUpdate",value:function(){if(this.UpdateShape(this.transform),null!=this.line){this.line.clear();var e=this.FacePonintsA();this.line.addLine(e[0],e[1]),this.line.addLine(e[2],e[3]),this.line.addLine(e[4],e[5]),this.line.addLine(e[6],e[7]);var t=this.FacePonintsTop();this.line.addLine(t[0],t[1]),this.line.addLine(t[2],t[3]),this.line.addLine(t[4],t[5]),this.line.addLine(t[6],t[7])}}},{key:"onAwake",value:function(){_get(_getPrototypeOf(AABBShape.prototype),"onAwake",this).call(this),this.onUpdate(),b.showaabbBoxLine&&(this.line=this.owner.addComponent(D))}},{key:"onEnable",value:function(){}},{key:"onDisable",value:function(){null!=this.line&&this.line.clear()}},{key:"rightBottomPonint",value:function(){return new Laya.Vector3(0,this.minPoint.y,this.maxPoint.z)}},{key:"FacePonintsA",value:function(){var e=[],t=this.minPoint.z;return e.push(new Laya.Vector3(this.minPoint.x,this.minPoint.y,t)),e.push(new Laya.Vector3(this.maxPoint.x,this.minPoint.y,t)),e.push(new Laya.Vector3(this.minPoint.x,this.maxPoint.y,t)),e.push(new Laya.Vector3(this.maxPoint.x,this.maxPoint.y,t)),e.push(new Laya.Vector3(this.minPoint.x,this.minPoint.y,t)),e.push(new Laya.Vector3(this.minPoint.x,this.maxPoint.y,t)),e.push(new Laya.Vector3(this.maxPoint.x,this.minPoint.y,t)),e.push(new Laya.Vector3(this.maxPoint.x,this.maxPoint.y,t)),e}},{key:"FacePonintsTop",value:function(){var e=[],t=this.maxPoint.z,n=this.minPoint.z;return e.push(new Laya.Vector3(this.minPoint.x,this.maxPoint.y,n)),e.push(new Laya.Vector3(this.maxPoint.x,this.maxPoint.y,n)),e.push(new Laya.Vector3(this.minPoint.x,this.maxPoint.y,t)),e.push(new Laya.Vector3(this.minPoint.x,this.maxPoint.y,n)),e.push(new Laya.Vector3(this.maxPoint.x,this.maxPoint.y,t)),e.push(new Laya.Vector3(this.maxPoint.x,this.maxPoint.y,n)),e.push(new Laya.Vector3(this.minPoint.x,this.maxPoint.y,t)),e.push(new Laya.Vector3(this.maxPoint.x,this.maxPoint.y,t)),e}},{key:"UpdateShape",value:function(e){V.add_Fast(this.center,e.position,this._center),V.mul_Num_Fast(this.size,.5,this.halfSize),V.sub_Fast(this._center,this.halfSize,this.minPoint),V.add_Fast(this._center,this.halfSize,this.maxPoint)}},{key:"Intersects",value:function(e){return this.minPoint.x<e.maxPoint.x&&this.minPoint.y<e.maxPoint.y&&this.minPoint.z<e.maxPoint.z&&e.minPoint.x<this.maxPoint.x&&e.minPoint.y<this.maxPoint.y&&e.minPoint.z<this.maxPoint.z}}]),AABBShape}(),E=function(){function GameObject$1(e){_classCallCheck(this,GameObject$1),this.node=e,this.sprite3d=e}return _createClass(GameObject$1,[{key:"Clone_sprite3d",value:function(){return Laya.Sprite3D.instantiate(this.sprite3d)}}],[{key:"getFullPath",value:function(e){if(null!=e){var t=[];t.push(e.name);var n=e;if(null!=n)for(;null!=n.parent;)n=n.parent,t.push(n.name);for(var a="",i=t.length-1;i>=0;i--)a+=t[i]+"/";console.log(a)}else console.error("You must select Obj first!")}},{key:"GetChilds",value:function(e,t){for(var n=[],a=0;a<e.numChildren;a++){var i=e.getChildAt(a);i.name==t&&n.push(i)}return n}},{key:"GetChildsByDeth",value:function(e,t){for(var n=GameObject$1.getAllChilds(e),a=[],i=0;i<n.length;i++){var o=n[i];o.name==t&&a.push(o)}return a}},{key:"Find",value:function(e,t){for(var n=t.split("/"),a=e.getChildByName(n[0]),i=1;i<n.length;i++)a=a.getChildByName(n[i]);return a}},{key:"FindChilds",value:function(e,t){for(var n=[],a=0;a<t.numChildren;a++){var i=t.getChildAt(a);e==i.name&&n.push(i)}return n}},{key:"Instantiate",value:function(e){return Laya.Sprite3D.instantiate(e.sprite3d)}},{key:"Instantiate2Scene",value:function(e,t){var n=Laya.Sprite3D.instantiate(e);return t.addChild(n),n}},{key:"Instantiate2Scene_Particle3d",value:function(e,t){var n=e.clone();return t.addChild(n),n}},{key:"Instantiate2SceneUseScene",value:function(e,t){var n=Laya.Sprite3D.instantiate(e);return t.addChild(n),n}},{key:"InstantiateGob",value:function(e){return null==e?null:Laya.Sprite3D.instantiate(e)}},{key:"Add2Scene",value:function(e,t){t.addChild(e)}},{key:"InstantiateNoScene",value:function(e){return Laya.Sprite3D.instantiate(e)}},{key:"GetTypeInChildren",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=e._children[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var r=o.value;if(r instanceof t)return r}}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return null}},{key:"GetTypesInChildren",value:function(e,t){var n=[],a=!0,i=!1,o=void 0;try{for(var s,r=e._children[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var l=s.value;l instanceof t&&n.push(l)}}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return n}},{key:"FindUseNode",value:function(e,t){var n=e.split("/");if(null==n||0==n.length)return t.getChildByName(e);for(var a=t.getChildByName(n[0]),i=1;i<n.length;i++)a=a.getChildByName(n[i]);return a}},{key:"FindUseNodeNoDeth",value:function(e,t){return t.getChildByName(e)}},{key:"FindChildAtUseNode",value:function(e,t){return t.getChildAt(e)}},{key:"getChildAttUseNode",value:function(e,t){return t.getChildAt(e)}},{key:"GetComponentsInChildren",value:function(e,t){if(null==e)return null;var n=GameObject$1.getChildsDeth(e),a=[],i=!0,o=!1,s=void 0;try{for(var r,l=n[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;u instanceof t&&a.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return a}},{key:"GetComponentsInChildrenU3d",value:function(e,t){if(null==e)return null;var n=GameObject$1.getChildsDeth(e),a=[],i=!0,o=!1,s=void 0;try{for(var r,l=n[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value.getComponent(t);null!=u&&a.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return a}},{key:"FindChilds_deth",value:function(e,t){if(null==e)return null;var n=GameObject$1.getChildsDeth(e),a=[],i=!0,o=!1,s=void 0;try{for(var r,l=n[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;u.name==t&&a.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return a}},{key:"getAllChilds",value:function(e){for(var t=[],n=[],a=0;a<e.numChildren;a++)n.push(e.getChildAt(a));for(var i=0,o=n;i<o.length;i++){var s=o[i];t.push(s)}for(var r=0;r<n.length;r++){var l=this.getAllChilds(n[r]),u=!0,c=!1,h=void 0;try{for(var d,y=l[Symbol.iterator]();!(u=(d=y.next()).done);u=!0){var f=d.value;t.push(f)}}catch(e){c=!0,h=e}finally{try{u||null==y.return||y.return()}finally{if(c)throw h}}}return t}},{key:"getChildsByNameDeth",value:function(e,t){var n=[],a=GameObject$1.getAllChilds(e),i=!0,o=!1,s=void 0;try{for(var r,l=a[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;u.name==t&&n.push(u)}}catch(e){o=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}return n}},{key:"getChildsDeth",value:function(e){var t=[],n=GameObject$1.getAllChilds(e),a=!0,i=!1,o=void 0;try{for(var s,r=n[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var l=s.value;t.push(l)}}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return t}}]),GameObject$1}(),R=function(){function SeedRnd(e){_classCallCheck(this,SeedRnd),this.seed=1,this.seed=e}return _createClass(SeedRnd,[{key:"rnd",value:function(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280}},{key:"getRandomInt",value:function(e,t){var n=t-e;return e+Math.round(this.rnd()*n)}},{key:"getRandomInt_NotIncludeMax",value:function(e,t){return this.getRandomInt(e,t-1)}},{key:"getRandomIntArry",value:function(e){return e[this.getRandomInt(0,e.length-1)]}}]),SeedRnd}(),B=function SpawnItem(){_classCallCheck(this,SpawnItem)},G=function(e){function BaseSpawn(){var e;return _classCallCheck(this,BaseSpawn),(e=_possibleConstructorReturn(this,_getPrototypeOf(BaseSpawn).apply(this,arguments))).runtimeItems=[],e.poolsignMap=new v,e.currentZ=0,e.startCreateZ=0,e.seed=new R(0),e}return _inherits(BaseSpawn,Laya.Script),_createClass(BaseSpawn,[{key:"onStart",value:function(){this.startCreateZ=this.spwanConfigObj.startCreateZ,this.Create2End()}},{key:"endZ",value:function(){return this.currentZ+this.spwanConfigObj.CreateLength}},{key:"Create2End",value:function(){for(var e=this.endZ();this.startCreateZ<e;){var t=this.DoSpawnItem(this.startCreateZ);this.startCreateZ+=t.spwanItemData.length}}},{key:"DoSpawnItem",value:function(e){var t=this,n=this.seed.getRandomInt_NotIncludeMax(0,this.spwanConfigObj.spwanItemDatas.length),a=this.spwanConfigObj.spwanItemDatas[n],i=Laya.Pool.getItemByCreateFun(a.goName,function(){return t.CreateSpwanItem(a)},this);return this.scene.addChild(i.gob),this.onSpawn(i.gob,a,e),i.gob.active=!0,i}},{key:"CreateSpwanItem",value:function(e){var t=E.Find(this.scene,this.spwanConfigObj.findRoot+"/"+e.goName),n=Laya.Sprite3D.instantiate(t);this.scene.addChildren(n),n.active=!0;var a=new B;return a.gob=n,a.spwanItemData=e,this.runtimeItems.push(a),this.poolsignMap.setValue(e.goName,"poolsign"),a}},{key:"onSpawn",value:function(e,t,n,a,i){}},{key:"onUpdate",value:function(){this.Create2End(),this.recoverLessZ()}},{key:"recoverLessZ",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.runtimeItems[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;if(o.gob.displayedInStage){var s=o.spwanItemData.length;o.gob.transform.position.z+.5*s<this.currentZ+this.spwanConfigObj.recoverOffset&&(Laya.Pool.recover(o.spwanItemData.goName,o),o.gob.removeSelf())}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"recoverAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.runtimeItems[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;Laya.Pool.recover(o.spwanItemData.goName,o),o.gob.removeSelf()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"onDestroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.poolsignMap.keys[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;Laya.Pool.clearBySign(o)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),BaseSpawn}(),U=function(e){function BuildSpawn(){var e;return _classCallCheck(this,BuildSpawn),(e=_possibleConstructorReturn(this,_getPrototypeOf(BuildSpawn).apply(this,arguments))).runtimeItems=[],e.poolsignMap=new v,e.currentZ=0,e.startCreateZ=0,e.seed=new R(0),e}return _inherits(BuildSpawn,G),_createClass(BuildSpawn,[{key:"onStart",value:function(){this.startCreateZ=this.spwanConfigObj.startCreateZ,this.Create2End()}},{key:"endZ",value:function(){return this.currentZ+this.spwanConfigObj.CreateLength}},{key:"Create2End",value:function(){for(var e=this.endZ();this.startCreateZ<e;){var t=this.DoSpawnItem(this.startCreateZ);this.startCreateZ+=t.spwanItemData.length}}},{key:"DoSpawnItem",value:function(e){var t=this,n=this.spwanConfigObj.spwanItemDatas[0],a=Laya.Pool.getItemByCreateFun(n.goName,function(){return t.CreateSpwanItem(n)},this);return this.scene.addChild(a.gob),this.onSpawn(a.gob,n,e),a}},{key:"CreateSpwanItem",value:function(e){var t=E.Find(this.scene,this.spwanConfigObj.findRoot+"/"+e.goName),n=Laya.Sprite3D.instantiate(t);this.scene.addChildren(n),n.active=!0;var a=new B;return a.gob=n,a.spwanItemData=e,this.runtimeItems.push(a),this.poolsignMap.setValue(e.goName,"poolsign"),a}},{key:"onSpawn",value:function(e,t,n){e.transform.position=new Laya.Vector3(0,0,n);var a=e.transform.localScale,i=this.seed.getRandomIntArry([-1,1]);a.x=i,e.transform.localScale=a}},{key:"onUpdate",value:function(){this.Create2End(),this.recoverLessZ_build()}},{key:"recoverLessZ_build",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.runtimeItems[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;if(o.gob.displayedInStage){var s=o.spwanItemData.length;o.gob.transform.position.z+.5*s<this.currentZ+this.spwanConfigObj.recoverOffset&&(o.gob.transform.localScaleX=1,Laya.Pool.recover(o.spwanItemData.goName,o),o.gob.removeSelf())}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"onDestroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.poolsignMap.keys[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;Laya.Pool.clearBySign(o)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),BuildSpawn}(),N=function(e){function FishSpwan(){var e;return _classCallCheck(this,FishSpwan),(e=_possibleConstructorReturn(this,_getPrototypeOf(FishSpwan).apply(this,arguments))).gap=0,e.xpos=0,e}return _inherits(FishSpwan,G),_createClass(FishSpwan,[{key:"Create2End",value:function(){for(var e=this.endZ();this.startCreateZ<e;){this.xpos=this.seed.getRandomIntArry([-1.25,0,1.25]);for(var t=0;t<5;t++){var n=this.DoSpawnItem(this.startCreateZ);this.startCreateZ+=n.spwanItemData.length}this.gap=this.seed.getRandomInt(10,30),this.startCreateZ+=this.gap}}},{key:"onSpawn",value:function(e,t,n){e.transform.position=new Laya.Vector3(this.xpos,.41,n),e.active=!0}},{key:"CreateSpwanItem",value:function(e){var t=_get(_getPrototypeOf(FishSpwan.prototype),"CreateSpwanItem",this).call(this,e),n=t.gob,a=new A;return a.mask=O.Fish,a.collisionMask=0,a.size=new Laya.Vector3(1,1,.34),a.center=new Laya.Vector3(0,0,0),n.addComponentIntance(a),t}}]),FishSpwan}(),j=function(){function MathUtli(){_classCallCheck(this,MathUtli)}return _createClass(MathUtli,null,[{key:"radianToDegree",value:function(e){return 180*e/Math.PI}},{key:"degreeToRadian",value:function(e){return e*Math.PI/180}},{key:"randomInt",value:function(e,t){var n=t-e+1;return Math.floor(e+Math.random()*n)}},{key:"deepCopy",value:function(e){if(null==e||{}==e||[]==e)return e;var t,n=!1;e.length?(t=[],n=!0):(t={},n=!1);for(var a=0,i=Object.keys(e);a<i.length;a++){var o=i[a];if(null==e[o])t[o]=e[o];else{var s="object"==_typeof(e[o])?this.deepCopy(e[o]):e[o];n?t.push(s):t[o]=s}}return t}}]),MathUtli}(),F=function(e){function HouseSpawn(e){var t;return _classCallCheck(this,HouseSpawn),(t=_possibleConstructorReturn(this,_getPrototypeOf(HouseSpawn).call(this)))._flip=1,t._houseSpace=5,t.randomScaleX=1,t.randomScaleX=e,t}return _inherits(HouseSpawn,U),_createClass(HouseSpawn,[{key:"onStart",value:function(){this.Create2End()}},{key:"Create2End",value:function(){for(var e=this.endZ(),t=this.startCreateZ;t<e;){var n=this.DoSpawnItem(this.startCreateZ);this.startCreateZ+=n.spwanItemData.length+this._houseSpace,t=this.startCreateZ}}},{key:"onSpawn",value:function(e,t,n){e.transform.position=new Laya.Vector3(0,0,n),-1==e.transform.localScaleX&&(e.transform.localScaleX=1),e.transform.localScale=new Laya.Vector3(1*this.randomScaleX,1,1)}},{key:"DoSpawnItem",value:function(e){var t=this,n=j.randomInt(0,this.spwanConfigObj.spwanItemDatas.length-1),a=this.spwanConfigObj.spwanItemDatas[n],i=Laya.Pool.getItemByCreateFun(a.goName,function(){return t.CreateSpwanItem(a)},this);return this.scene.addChild(i.gob),this.onSpawn(i.gob,a,e),i}}]),HouseSpawn}(),z=function(){function RandomData(){_classCallCheck(this,RandomData),this._configArray=null,this.initArray()}return _createClass(RandomData,[{key:"initArray",value:function(){var e=Laya.loader.getRes("config/random.json"),t=new Array;for(var n in e){var a=e[n];t.push(a)}this._configArray=j.deepCopy(t)}},{key:"createRandomNumber",value:function(){for(var e=[],t=this._configArray.length,n=(new Date).getTime(),a=0;a<t;a++){console.log("================随机第",a,"数据=================");var i=this.createRandowByIndex(a);i.push(12),e=e.concat(i)}var o=(new Date).getTime();return console.log("=======================运行时间：",o-n,"==========================="),e}},{key:"createRandowByIndex",value:function(e){for(var t=this._configArray[e],n=[],a=t.totalTimes,i=t.randomTimes,o=t.randomArray,s=this.getRandomArrayUse(o);a;){var r=s[j.randomInt(0,s.length-1)];n.push(r);for(var l=0;l<o.length;l++){if(o[l].indexOf(r)>-1){i[l]-=1,0==i[l]&&(o.splice(l,1),i.splice(l,1),s=this.getRandomArrayUse(o));break}}a-=1}return n}},{key:"getRandomArrayUse",value:function(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];t=t.concat(a)}return t}}]),RandomData}(),X=function(){function MapData(){_classCallCheck(this,MapData),this._randomDataArray=null,this._len=0,this._curUsingArray=null,this.initRandom()}return _createClass(MapData,[{key:"initRandom",value:function(){var e=new z;this._randomDataArray=e.createRandomNumber(),this._len=this._randomDataArray.length}},{key:"create",value:function(){for(var e=0;e<this._len;e++)this._randomDataArray[e]}},{key:"popUsedData",value:function(){var e=0;return null!=this._randomDataArray&&this._randomDataArray.length>0&&(e=this._randomDataArray.shift()),e}},{key:"createRoadDataByType",value:function(){var e=this.popUsedData(),t=Laya.loader.getRes("config/model_"+e+".json").ed["model_"+e+"Table"];return this.organizeData(t)}},{key:"getRowConfig",value:function(){return null==this._curUsingArray&&(this._curUsingArray=new Array),0==this._curUsingArray.length&&(this._curUsingArray=this.createRoadDataByType()),this._curUsingArray.shift()}},{key:"organizeData",value:function(e){var t=[];for(var n in e){var a=e[n];t.push(a)}return t}}]),MapData}(),H=function(e){function Rotation(){var e;return _classCallCheck(this,Rotation),(e=_possibleConstructorReturn(this,_getPrototypeOf(Rotation).call(this)))._transform=null,e._speed=.1,e}return _inherits(Rotation,Laya.Script),_createClass(Rotation,[{key:"onAwake",value:function(){this._transform=this.owner.transform}},{key:"onUpdate",value:function(){if(null!=this._transform){var e=Laya.timer.delta*this._speed;this.owner.active&&this._transform.rotate(new Laya.Vector3(0,e,0),!0,!1)}}},{key:"resetTransform",value:function(e){this._transform=e}},{key:"recover",value:function(){this._transform=null}}]),Rotation}(),Z=function Obstacle(){_classCallCheck(this,Obstacle)},Y=function(t){function ObstacleSpawn(){var e;return _classCallCheck(this,ObstacleSpawn),(e=_possibleConstructorReturn(this,_getPrototypeOf(ObstacleSpawn).apply(this,arguments)))._obstacleSpawnArray=["jiasu","jinbi","jinche","chonglangban","xiahualangan","shangche","dabache","dabacheding","huapo","guanggaopai","jiazi","ludeng","xiaofangshuan","lajitong","clbani_r","clbani_l"],e._decorateObjName=["guanggaopai","jiazi","ludeng","xiaofangshuan","lajitong"],e.itemMap=new v,e.gap=10,e._mapData=null,e._guideOffZArray=[8,4.5],e.starBigSacle=new Laya.Vector3(2,2,2),e.starsamllSacle=new Laya.Vector3(1,1,1),e.guideIdx=0,e._initRotationEulerY=0,e}return _inherits(ObstacleSpawn,G),_createClass(ObstacleSpawn,[{key:"onAwake",value:function(){this._mapData=new X}},{key:"Create2End",value:function(){for(var t=this.endZ();this.startCreateZ<t;){var n=0;this.guideIdx<=1&&e.isGuide?(this.DoSpawnItemGuider(this.startCreateZ+14),n=20,$.instance.guiderz[this.guideIdx-1]=20*this.guideIdx-this._guideOffZArray[this.guideIdx-1],this.startCreateZ+=20):$.instance.useSpwanobstacle&&this.DoSpawnItem(this.startCreateZ),$.instance.useSpwanobstacle?this.startCreateZ+=2:this.startCreateZ+=50+this.gap+n}}},{key:"DoSpawnItem",value:function(e){var t=this,n=this._mapData.getRowConfig();for(var a in n)if(Object.prototype.hasOwnProperty.call(n,a)){if("row"==a)continue;var i=n[a];if(1==i.length&&0==i[0])continue;for(var o=this.getConfigIndex(a),s=this.spwanConfigObj.spwanItemDatas[o],r=[],l=0;l<i.length;l++){if("jinbi"==s.goName)r=i[l].split("|");var u=Laya.Pool.getItemByCreateFun(s.goName,function(){return t.CreateSpwanItem(s)},this);if("clbani_r"==s.goName||"clbani_l"==s.goName)u.gob.getChildAt(0).getComponent(Laya.Animator).play("idle"),$.instance.aniArray.push(u.gob);this.scene.addChild(u.gob),"jinbi"==s.goName&&r.length>1?this.onSpawn(u.gob,s,e,parseInt(r[0]),parseInt(r[1])):this.onSpawn(u.gob,s,e,i[l]),u.gob.active=!0}}return null}},{key:"getConfigIndex",value:function(e){return this._obstacleSpawnArray.indexOf(e)}},{key:"DoSpawnItemGuider",value:function(e){var t=this,n=this.guideIdx;0==this.guideIdx&&(n=2),1==this.guideIdx&&(n=4);var a=this.spwanConfigObj.spwanItemDatas[n],i=Laya.Pool.getItemByCreateFun(a.goName,function(){return t.CreateSpwanItem(a)},this);return this.scene.addChild(i.gob),this.onSpawnGuide(i.gob,a,e,0),this.guideIdx+=1,i}},{key:"onSpawn",value:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if("jinche"==t.goName||"shangche"==t.goName||"dabache"==t.goName||"dabacheding"==t.goName){var o=[-3.2,0,3.2][a-1];e.transform.position=new Laya.Vector3(o,0,n+2)}else if("huapo"==t.goName){var s=[-3.2,0,3.2][a-1];e.transform.position=new Laya.Vector3(s,0,n+2)}else if("jinbi"==t.goName||"jiasu"==t.goName){var r=[-3.1,0,3.1][a-1];this._initRotationEulerY+=30,this._initRotationEulerY>=360&&(this._initRotationEulerY=0),e.transform.localRotationY=j.degreeToRadian(this._initRotationEulerY),this.addRotationScript(e),e.active=!0,e.transform.position=new Laya.Vector3(r,i,n+1)}else if("chonglangban"==t.goName){var l=[-2.8,0,2.8][a-1];e.transform.position=new Laya.Vector3(l,0,n+1)}else if("clbani_r"==t.goName||"clbani_l"==t.goName){var u=[-3,0,3][a-1];e.transform.position=new Laya.Vector3(u,0,n+1)}else if("xiahualangan"==t.goName){var c=[-3.2,0,3.2][a-1];e.transform.position=new Laya.Vector3(c,0,n+1)}this._decorateObjName.indexOf(t.goName)>=0&&(e.transform.localScaleX=1==a?-1:1,e.transform.position=new Laya.Vector3(0,0,n+2))}},{key:"addRotationScript",value:function(e){e.getComponent(H)||e.addComponent(H)}},{key:"onSpawnGuide",value:function(e,t,n,a){e.transform.position=new Laya.Vector3(a,0,n),this.itemMap.getValue(e.id).collider.enabled=!0}},{key:"SpawnObstacle2",value:function(e,t,n){var a=Math.random();n<0&&(n=a>=.5?1.27:0),0==n&&(n=a>=.5?-1.27:1.27),n>0&&(n=a>=.5?-1.27:0),e.transform.position=new Laya.Vector3(n,0,t);var i=this.itemMap.getValue(e.id);i.ani.play("idle",0,0),i.collider.enabled=!0}},{key:"CreateSpwanItem",value:function(e){var t=_get(_getPrototypeOf(ObstacleSpawn.prototype),"CreateSpwanItem",this).call(this,e);if(this._decorateObjName.indexOf(e.goName)>=0)return t;var n=t.gob,a=new Z,i=n.getChildAt(0).getComponent(Laya.Animator);a.ani=i,this.itemMap.setValue(n.id,a);var o=n,s=this.addBoxCollider(e.goName);return a.collider=s,o.addComponentIntance(s),t}},{key:"addBoxCollider",value:function(e){var t=new A;return t.mask=O.Obstacle,t.collisionMask=0,"jinche"==e?(t.center=new Laya.Vector3(0,0,0),t.size=new Laya.Vector3(3,1,3.2)):"chonglangban"==e?(t.center=new Laya.Vector3(0,.2,.25),t.size=new Laya.Vector3(2,5,.5)):"clbani_r"==e?(t.size=new Laya.Vector3(5,1,.3),t.center=new Laya.Vector3(-1.5,-.2,0),t.tag="clb"):"clbani_l"==e?(t.tag="clb",t.size=new Laya.Vector3(5,1,.3),t.center=new Laya.Vector3(1.5,-.2,0)):"xiahualangan"==e?(t.center=new Laya.Vector3(0,2.6,0),t.size=new Laya.Vector3(2.5,1,.5)):"dabache"==e?(t.mask=O.Obstacle,t.collisionMask=0,t.center=new Laya.Vector3(0,.6,-1.8),t.size=new Laya.Vector3(1.6,.6,19)):"dabacheding"==e?(t.mask=O.PaoDao,t.collisionMask=0,t.center=new Laya.Vector3(0,4.5,0),t.size=new Laya.Vector3(1,3,16)):"huapo"==e?(t.mask=O.HuaPo,t.collisionMask=0,t.center=new Laya.Vector3(0,1.5,-10.8),t.size=new Laya.Vector3(.8,3,5.5)):"jinbi"==e?(t.mask=O.Gold,t.collisionMask=0,t.center=new Laya.Vector3(0,.2,0),t.size=new Laya.Vector3(1,1,.3)):"jiasu"==e&&(t.mask=O.JiaSu,t.collisionMask=0,t.center=new Laya.Vector3(0,1,0),t.size=new Laya.Vector3(1,1,.2)),t}},{key:"CreateSpwanStar",value:function(e){var t=_get(_getPrototypeOf(ObstacleSpawn.prototype),"CreateSpwanItem",this).call(this,e),n=t.gob,a=new Z;this.itemMap.setValue(n.id,a);var i=new A,o=n;return i.mask=O.Award,i.collisionMask=0,i.center=new Laya.Vector3(0,0,0),i.size=new Laya.Vector3(.5,.5,.5),o.addComponentIntance(i),a.collider=i,t}},{key:"recoverLessZ",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.runtimeItems[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;if(o.gob.displayedInStage){var s=o.spwanItemData.length;o.gob.transform.position.z+.5*s<this.currentZ+this.spwanConfigObj.recoverOffset&&(o.gob.transform.localRotation=new Laya.Quaternion(0,0,0,1),o.gob.transform.localScaleX=1,null!=o.gob.getComponent(H)&&o.gob.getComponent(H).destroy(),Laya.Pool.recover(o.spwanItemData.goName,o),o.gob.removeSelf())}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"recoverAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var a,i=this.runtimeItems[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;Laya.Pool.recover(o.spwanItemData.goName,o);var s=o.gob.getComponent(A);s&&s.destroy(),o.gob.removeSelf()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}]),ObstacleSpawn}(),W=function(e){function MonoBehaviour(){return _classCallCheck(this,MonoBehaviour),_possibleConstructorReturn(this,_getPrototypeOf(MonoBehaviour).apply(this,arguments))}return _inherits(MonoBehaviour,Laya.Script),_createClass(MonoBehaviour,[{key:"onAwake",value:function(){this.gameObject=this.owner,this.transform=this.gameObject.transform}},{key:"Find",value:function(e){return E.Find(this.gameObject,e)}},{key:"GetComponentsInChildren",value:function(e){return E.GetComponentsInChildrenU3d(this.gameObject,e)}}]),MonoBehaviour}(),J=function(e){function Input(){var e;return _classCallCheck(this,Input),(e=_possibleConstructorReturn(this,_getPrototypeOf(Input).call(this))).count=0,e.counttime=0,e.preMouseX=0,e.firstX=-12345678,e.seconx=0,e.mouseDown_y=0,e.mouseDown_y_Time=0,e.slide_mouseDown_x=0,e.sensitivity=.2,e}return _inherits(Input,Laya.Script),_createClass(Input,[{key:"onAwake",value:function(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.p_onMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.p_onMouseUp),Laya.stage.on(Laya.Event.KEY_DOWN,this,this.onKeyDownEvent),Laya.stage.on(Laya.Event.KEY_UP,this,this.onKeyUpEvent),this.preMouseX=Laya.MouseManager.instance.mouseX}},{key:"onKeyDownEvent",value:function(e){Input.dicKeyDown[e.keyCode]=!0,Input.dicKeyUpdate[e.keyCode]=!0}},{key:"onKeyUpEvent",value:function(e){Input.dicKeyDown[e.keyCode]=!1,Input.dicKeyUpdate[e.keyCode]=!1}},{key:"p_onMouseDown",value:function(){Input.mouseButton0down=!0,Input.mouseButton0Up=!1,Input.mouseButton0DwonHold=!0}},{key:"p_onMouseUp",value:function(){Input.mouseButton0Up=!0,Input.mouseButton0down=!1,Input.mouseButton0DwonHold=!1}},{key:"onLateUpdate",value:function(){if(Input.mouseButton0down=!1,Input.mouseButton0Up=!1,Input.GetAxisRaw_Mouse_X=0,Input.slideUp=!1,Input.slidedown=!1,Input.slideLeft=!1,Input.slideRight=!1,Laya.Browser.onPC){for(var e in Input.dicKeyDown)Input.dicKeyDown[e]=!1;for(var t in Input.dicKeyUpdate)Input.dicKeyUpdate[t]=!1}}},{key:"onUpdate",value:function(){this.onUpdate_mouse()}},{key:"onUpdate_mouse",value:function(){if(Input.mouseButton0DwonHold)if(-12345678==this.firstX)this.firstX=Laya.stage.mouseX;else{this.seconx=Laya.stage.mouseX;var e=this.seconx-this.firstX;this.firstX=this.seconx,Input.GetAxisRaw_Mouse_X=e}if(Input.mouseButton0Up&&(Input.GetAxisRaw_Mouse_X=0,this.firstX=-12345678,this.seconx=0),Input.mouseButton0down&&(this.mouseDown_y=Laya.MouseManager.instance.mouseY,this.mouseDown_y_Time=n.time,this.slide_mouseDown_x=Laya.MouseManager.instance.mouseX),Input.mouseButton0Up){var t=Laya.MouseManager.instance.mouseY,a=Laya.MouseManager.instance.mouseX,i=n.time-this.mouseDown_y_Time<.3,o=this.mouseDown_y-t;i&&(o>100*this.sensitivity?(Input.slideUp=!0,Input.slideYdis=o):o<-100*this.sensitivity&&(Input.slidedown=!0,Input.slideYdis=o),this.slide_mouseDown_x-a>100*this.sensitivity?(Input.slideLeft=!0,Input.slideXdis=this.slide_mouseDown_x-a):a-this.slide_mouseDown_x>100*this.sensitivity&&(Input.slideRight=!0,Input.slideXdis=a-this.slide_mouseDown_x))}}}],[{key:"GetKeyDown",value:function(e){return 0!=Laya.Browser.onPC&&Input.dicKeyDown[e]}},{key:"GetKey",value:function(e){return 0!=Laya.Browser.onPC&&(null!=Input.dicKeyUpdate[e]&&Input.dicKeyUpdate[e])}}]),Input}();J.mouseButton0down=!1,J.mouseButton0Up=!1,J.mouseButton0DwonHold=!1,J.dicKeyDown={},J.dicKeyUpdate={},J.GetAxisRaw_Mouse_X=0,J.slideUp=!1,J.slidedown=!1,J.slideLeft=!1,J.slideRight=!1,J.slideXdis=0,J.slideYdis=0;var K=function(t){function Player(){var e;return _classCallCheck(this,Player),(e=_possibleConstructorReturn(this,_getPrototypeOf(Player).apply(this,arguments))).canJump=!0,e.localx=0,e.isdeath=!1,e._endEffect=null,e._goldEffect=null,e._addSpeedEffect=null,e.guiderIdx=-1,e.jumpy=0,e.readBigJump=0,e.fasRunTime=0,e.IsFastRun=!1,e.IsWudi=!1,e.curstarPower=0,e.initOk=!1,e.actionLeft=2,e.actionRight=3,e.actionUp=0,e.actionDown=1,e.actionSamllJump=4,e.challengeEnd=!1,e.fanzhuanyidong=!1,e._moveX=3.1,e.baseHitScore=0,e._playerYState=-1,e._curSlope=null,e._cueCollisionTarget=null,e._endTimes=0,e._jumpForward=!1,e._frontZ=0,e.rebornRead=!1,e._lastAction=-1,e._isTranslation=!1,e._jumpY=0,e._initCameraY=0,e.addpowerTime=0,e.isbigJump=!1,e.jumpTime=0,e.issliderDwon=!1,e._trail=null,e.cameraOrz=-6.13,e}return _inherits(Player,W),_createClass(Player,[{key:"onAwake",value:function(){_get(_getPrototypeOf(Player.prototype),"onAwake",this).call(this),this._gameModule=fe.instance.gameModule;var e=new A;e.mask=O.Character,e.collisionMask=1<<O.Obstacle|1<<O.Gold|1<<O.JiaSu|1<<O.PaoDao|1<<O.HuaPo|1<<O.End,e.size=new Laya.Vector3(1.5,2.2,1),e.center=new Laya.Vector3(0,1.2,0),this.aabbshape=this.gameObject.addComponentIntance(e),e.ActiveDetec(),e.RegisetCollsionEnter(this,this.OnCollisionEnter),e.RegisetCollsionExit(this,this.OnCollisionExit),this.initCat(),this._addSpeedEffect=this.gameObject.getChildByName("jiasu"),this._addSpeedEffect.active=!1,this.gameObject.getChildByName("BlobShadow").transform.localPositionX=-.1;var t=this.gameObject.parent.getChildByName("cameraAnimation");null!=t&&(this.cameraAnimator=t.getComponent(Laya.Animator),this.cameraAnimatorTrs=t.transform),this.UIhitEffect=this.gameObject.getChildByName("UIhit"),this._initCameraY=$.instance.camera.transform.localPositionY,this._playerYState=0}},{key:"OnCollisionEnter",value:function(t,n){if(n.mask==O.Gold)n.gameObject.active=!1,this._goldEffect.active=!0,$.instance.playerEatFish(),Laya.timer.once(400,this,this.hideGoldEffect);else if(n.mask==O.HuaPo)this._playerYState=1,this._curSlope=n;else if(n.mask==O.PaoDao)this._playerYState=2,this._curSlope=n,this._playerYState=2,this._frontZ=0,console.log("进入车顶:",n.transform.localPositionZ);else if(n.mask==O.End){if(this._endTimes+=1,4==this._endTimes)return e.gameOver=!0,void this.gameOver();this.IsFastRun=!1,$.instance.setLevelAddSpeed(!1,!0)}else if(n.mask==O.JiaSu)n.gameObject.active=!1,this.IsFastRun=!1,this.FastRun();else if(n.mask==O.Award)this.UIhitEffect.active=!1,this.UIhitEffect.active=!0,o.instance.starAward.Play(),n.owner.active=!1;else if(0==e.isGuide&&(n.mask==O.Obstacle||n.mask==O.PaoDao)){if(0==this.IsFastRun){if(this._curSlope)return;this._cueCollisionTarget=n.gameObject,this.Fail()}var a=$.instance.obstacleSpawn.itemMap.getValue(n.gameObject.id);"Rat"==n.tag?(n.objdata.ani.play("Dead"),n.objdata.collider.enabled=!1):"clb"==n.tag||a&&a.ani&&(a.ani.play("Dead"),a.collider.enabled=!1)}}},{key:"hideGoldEffect",value:function(){this._goldEffect.active=!1}},{key:"OnCollisionExit",value:function(e,t){t.mask==O.PaoDao?(this._curSlope=t,this._playerYState=this.checkNearBus(t)):t.mask}},{key:"checkNearBus",value:function(e){var t=$.instance.obstacleSpawn.itemMap;if(this._lastAction==this.actionRight||this._lastAction==this.actionLeft){for(var n=e.transform.localPositionZ-8,a=e.transform.localPositionZ+16,i=0;i<t.keys.length;i++){var o=t.values[i];if(o.collider.mask==O.PaoDao){var s=o.collider.transform.localPositionZ,r=o.collider.transform.localPositionX;if(s==e.transform.localPositionZ)continue;if(s>=n&&s<=a&&$.instance.cureentZ>s-8&&$.instance.cureentZ<s+8)return r>e.transform.localPositionX?this._lastAction==this.actionLeft?2:0:r<e.transform.localPositionX?this._lastAction==this.actionRight?2:0:2}}return 0}if(this._lastAction==this.actionUp){var l=this.checkJumpBus(e,t);return 0==l?this.fallDown():this._jumpForward=!0,l}return this.fallDown(),0}},{key:"fallDown",value:function(){this.playCatAni("TCatFallDown",1,0,.2),Laya.timer.once(300,this,this.crossFadeRunAfterBigJump),this.moveCameraY(0)}},{key:"checkJumpBus",value:function(e,t){for(var n=0;n<t.keys.length;n++){var a=t.values[n],i=e.transform.localPositionZ+25,o=e.transform.localPositionZ,s=e.transform.localPositionX;if(a.collider.mask==O.PaoDao){var r=a.collider.transform.localPositionZ;if(s!=a.collider.transform.localPositionX)continue;if(r>o&&r<i)return this._frontZ=r,2}}return 0}},{key:"Fail",value:function(){e.isGuide||this.IsWudi||this.isdeath||(u.vibrateLong(),$.instance.speed=0,this.playCatAni("TCatDeath",1),o.instance.CatDeath.Play(),$.instance.jumpaddspeed=0,$.instance.addspeed=0,$.instance.setLevelAddSpeed(!0),Laya.timer.once(1e3,this,function(){fe.instance.openOverView(!0),fe.instance.gameModule.hideView()}),this._gameModule.hideFishAndScore(),this.isdeath=!0)}},{key:"gameOver",value:function(){e.isGuide||this.IsWudi||this.isdeath||(u.vibrateLong(),$.instance.speed=0,$.instance.jumpaddspeed=0,$.instance.addspeed=0,$.instance.setLevelAddSpeed(!0),Laya.timer.once(500,this,function(){fe.instance.openOverView(!0),fe.instance.gameModule.hideView()}),this._gameModule.hideFishAndScore())}},{key:"Reborn",value:function(){this.rebornRead=!0,this.isdeath=!1,this.isbigJump=!1,this._curSlope=null,this.animator.speed=this.getCatRunSpeed(),this.animator.crossFade("TCatRun",.1),this.aabbshape.center.y=1.2,this._jumpY=0;var e=this._cueCollisionTarget.transform.localPositionZ-10,t=this._cueCollisionTarget.transform.localPositionZ+10;this._gameModule.reborn(),this.transform.localPositionY=0,fe.instance.gameModule.showView(),this.clearNearObject(e,t)}},{key:"clearNearObject",value:function(e,t){$.instance.obstacleSpawn.itemMap.forEach(function(n,a){var i=a.collider.transform.localPositionZ;i>=e&&i<=t&&(a.collider.gameObject.active=!1)})}},{key:"onUpdate",value:function(){if(!(this.isdeath||0==$.instance.isPlay||this.rebornRead||this.challengeEnd)){this.run();var e=this.getAction();this.runAction(e),this.getChangeLocalY(e),-1!=e&&2==this._playerYState&&(this._lastAction=e,e!=this.actionLeft&&e!=this.actionRight||this._frontZ&&(this._playerYState=0)),this._isTranslation?(this.transform.localPositionX=T.Lerp(this.transform.localPositionX,this.localx,.2),this.isbigJump=!1,this.transform.localPositionY=T.Lerp(this.transform.localPositionY,0,.2),Math.abs(this.localx)-Math.abs(this.transform.localPositionX)<.1&&(this._isTranslation=!1,this._jumpY=0)):this.transform.localPositionX=T.Lerp(this.transform.localPositionX,this.localx,.2),this.moveCameraX()}}},{key:"getChangeLocalY",value:function(e){var t=0;if(0==this._playerYState)t=0,this._curSlope=null,this.transform.localPositionY=this._jumpY,this.moveCameraY(0);else if(1==this._playerYState){if(!this._curSlope)return 0;var n=Math.abs($.instance.cureentZ-3.5-(this._curSlope.transform.localPositionZ-13.5));t=n<=5?Math.abs(n*Math.tan(j.degreeToRadian(30))):3.15,this.transform.localPositionY=this._jumpY+t,this.moveCameraY(t)}else 2==this._playerYState&&(t=3.15,this.transform.localPositionY=this._jumpY+t);return t}},{key:"run",value:function(){if(this.isbigJump){var e=(n.time-this.jumpTime)/.8;if(e>=1)return e=1,$.instance.jumpaddspeed=0,this.isbigJump=!1,this._jumpY=0,void(this.transform.localPositionY=0);var t=.8*Math.sin(e*Math.PI);t<=0&&(t=0),$.instance.jumpaddspeed=.3*t,this._jumpY=t}else $.instance.jumpaddspeed=0;if(this.IsFastRun){var a=(n.time-this.fasRunTime)/4;a>=1&&(a=1);var i=Math.sin(3.14*a);$.instance.addspeed=.5*i;(i*=3)>=1&&(i=1)}}},{key:"runAction",value:function(e){e==this.actionDown?this.sliderDwon():e==this.actionUp?this.BigJump():e==this.actionLeft?this.turnLeftOrRight(e):e==this.actionRight&&this.turnLeftOrRight(e)}},{key:"getAction",value:function(){(J.slideLeft||J.slideRight)&&(J.slideUp||J.slidedown)&&(Math.abs(J.slideXdis)>=Math.abs(J.slideYdis)?(J.slideUp=!1,J.slidedown=!1):(J.slideLeft=!1,J.slideRight=!1));var t=-1;return e.isGuide?(t=this.GuiDeUpdate(),$.instance.cureentZ>=40&&$.instance.GuideOk()):(t=this.GetPlayerAciont(),J.GetKeyDown(Laya.Keyboard.LEFT)&&(t=this.actionLeft),J.GetKeyDown(Laya.Keyboard.RIGHT)&&(t=this.actionRight),0!=this.canJump||t!=this.actionSamllJump&&t!=this.actionUp||(t=-1),this.fanzhuanyidong&&t==this.actionRight?t=this.actionLeft:this.fanzhuanyidong&&t==this.actionLeft&&(t=this.actionRight)),t}},{key:"turnLeftOrRight",value:function(e){var t=this,n="";e==this.actionLeft?(this.localx+=this._moveX,n="TCatLeft",this.localx>this._moveX&&(n=""),this.localx>=this._moveX&&(this.localx=this._moveX)):e==this.actionRight&&(this.localx-=this._moveX,n="TCatRight",this.localx<-this._moveX&&(n=""),this.localx<=-this._moveX&&(this.localx=-this._moveX)),1==this._playerYState&&Laya.timer.once(100,this,function(){t._playerYState=0}),this._trail.active=!0,Laya.timer.once(100,this,function(){t._trail.active=!1}),this._jumpY>0&&(this._isTranslation=!0),this.moveRightOrLeft(n)}},{key:"moveRightOrLeft",value:function(e){""!=e&&(this.playCatAni(e,1,0,.1),Laya.timer.once(100,this,this.crossFadeRun))}},{key:"moveCameraX",value:function(){var e=$.instance.camera,t=e.transform.position.x;e.transform.localPositionX=T.Lerp(t,this.localx,.2)}},{key:"moveCameraY",value:function(e){var t=$.instance.camera,n=t.transform.localPositionY,a=0;0!=e?(a=this._initCameraY+e,t.transform.localPositionY=T.Lerp(n,a,.2)):t.transform.localPositionY=this._initCameraY}},{key:"FastRunOver",value:function(){}},{key:"GetPlayerAciont",value:function(){return!J.mouseButton0Up||J.slideLeft||J.slideRight||J.slidedown||J.slideUp?J.slidedown&&0==this.isbigJump?this.actionDown:J.slideLeft?this.actionLeft:J.slideRight?this.actionRight:J.slideUp?this.actionUp:-1:this.actionSamllJump}},{key:"BigJump",value:function(){this.isbigJump||(o.instance.CatJump.Play(),this.playCatAni("TCatUp",1,0,0),Laya.timer.once(800,this,this.crossFadeRunAfterBigJump),Laya.timer.once(800,this,this.RestAnimatiorSpeed),this.isbigJump=!0,this.jumpTime=n.time)}},{key:"RestAnimatiorSpeed",value:function(){this.animator.speed=this.getCatRunSpeed()}},{key:"sliderDwon",value:function(){var e=this;this.issliderDwon||(this.issliderDwon=!0,this.aabbshape.center.y=0,this.playCatAni("TCatSlide",1,0,.15),Laya.timer.once(1e3,this,this.crossFadeRun),Laya.timer.once(1e3,this,function(){e.issliderDwon=!1,$.instance.jumpaddspeed=0}))}},{key:"GuiDeUpdate",value:function(){var e=this.GetPlayerAciont();return 0==this.guiderIdx&&e==this.actionUp?(this.animator.speed=1,$.instance.NextGuide(),this.guiderIdx=-1,e):1==this.guiderIdx&&e==this.actionDown?(this.animator.speed=1,$.instance.NextGuide(),this.guiderIdx=-1,e):2==this.guiderIdx&&e==this.actionRight?(this.animator.speed=1,$.instance.NextGuide(),this.guiderIdx=-1,e):3==this.guiderIdx&&e==this.actionLeft?(this.animator.speed=1,this.guiderIdx=-1,$.instance.NextGuide(),e):-1}},{key:"crossFadeRun",value:function(){this.isdeath||this.challengeEnd||(this.isbigJump=!1,this.aabbshape.center.y=1.2,this.animator.speed=this.getCatRunSpeed(),this.animator.crossFade("TCatRun",.2))}},{key:"crossFadeRunAfterBigJump",value:function(){this.isdeath||this.challengeEnd||(this.aabbshape.center.y=1.2,this.animator.speed=this.getCatRunSpeed(),this.animator.crossFade("TCatRun",.2))}},{key:"initCat",value:function(){if(null==this.cat){var e=E.Find($.instance.scene,"Resources/TCat");this.cat=Laya.Sprite3D.instantiate(e),this._trail=this.cat.getChildByName("trail"),this._goldEffect=this.cat.getChildByName("jinbi"),this._goldEffect.active=!1,this.gameObject.addChild(this.cat),this.cat.active=!1,this.animator=this.cat.getChildByName("TCat").getComponent(Laya.Animator),this.playCatAni("TCatRun",2),this.curAvater=this.cat,this.cat.transform.localPosition=new Laya.Vector3(0,0,0)}}},{key:"playCatAni",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;this.animator.speed=t,this.animator.play(e,n,a)}},{key:"StartRun",value:function(){this.cat.active=!0,this.curAvater.transform.localRotationEulerY=0,this.playCatAni("TCatStart",1),Laya.timer.frameOnce(180,this,this.crossFadeRun)}},{key:"FastRun",value:function(){var e=this;this.IsFastRun=!0,this._addSpeedEffect.active=!0,this.fasRunTime=n.time,this.curstarPower=0,this.playCatAni("TCatFastRun",1),Laya.timer.once(4e3,this,function(){e._addSpeedEffect.active=!1,e.IsFastRun=!1,$.instance.addspeed=0,e.animator.speed=e.getCatRunSpeed(),e.animator.crossFade("TCatRun",.1)}),o.instance.wineffect.PlayByNum(1),Laya.timer.once(3e3,this,function(){$.instance.useSpwanobstacle=!1}),Laya.timer.once(3e3,this,function(){$.instance.useSpwanobstacle=!0})}},{key:"onDestroy",value:function(){this.cat&&this.gameObject.removeChild(this.cat),this.aabbshape&&(this.aabbshape.destroy(),this.aabbshape=null),i.instance.offAllCaller(this)}},{key:"FaceToCamera",value:function(e){}},{key:"StartGuider",value:function(e){this.animator.speed=0,this.guiderIdx=e}},{key:"getCatRunSpeed",value:function(){var t=$.instance.getLevel();return e.catRunSpeeds[t]+1}},{key:"onEnable",value:function(){var e=this;Laya.timer.frameOnce(2,this,function(){i.instance.event(a.CharaterIniOk),e.UIhitEffect.active=!1})}}]),Player}(),q=function(e){function VertexColor(){var e;return _classCallCheck(this,VertexColor),(e=_possibleConstructorReturn(this,_getPrototypeOf(VertexColor).call(this))).setShaderName("VertexColor"),e._shaderValues.addDefine(VertexColor.SHADERDEFINE_ENABLEVERTEXCOLOR),e}return _inherits(VertexColor,Laya.Material),_createClass(VertexColor,null,[{key:"initShader",value:function(){if(!VertexColor.hasInt){VertexColor.hasInt=!0,VertexColor.SHADERDEFINE_ENABLEVERTEXCOLOR=Laya.Shader3D.getDefineByName("ENABLEVERTEXCOLOR");var e={a_Position:Laya.VertexMesh.MESH_POSITION0,a_Color:Laya.VertexMesh.MESH_COLOR0},t={u_MvpMatrix:Laya.Shader3D.PERIOD_SPRITE},n=Laya.Shader3D.add("VertexColor"),a=new Laya.SubShader(e,t);n.addSubShader(a),a.addShaderPass("\n            attribute vec4 a_Position;\n            uniform mat4 u_MvpMatrix;\n            \n            #if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n                attribute vec4 a_Color;\n                varying vec4 v_Color;\n            #endif\n\n            void main()\n            {\n                #if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n                v_Color = a_Color;\n                #endif\n                gl_Position = u_MvpMatrix * a_Position;\n            } ","\n        //不能少写这行\n        #ifdef FSHIGHPRECISION\n                precision highp float;\n            #else\n                precision mediump float;\n            #endif\n        \n        #if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n        varying vec4 v_Color;\n        #endif\n       \n        void main()\n        {\n        \n           #if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n              gl_FragColor=v_Color;\n            #else\n              gl_FragColor=vec4(1.0);\n            #endif\n          \n        }\n        ")}}}]),VertexColor}();q.hasInt=!1;var $=function(t){function GameScript(){var e;return _classCallCheck(this,GameScript),(e=_possibleConstructorReturn(this,_getPrototypeOf(GameScript).apply(this,arguments))).cureentZ=0,e.speed=.12,e.baseSpeed=.12,e.addspeed=0,e.jumpaddspeed=0,e._levelAddSpeed=0,e.spwans=[],e.isPlay=!1,e.guiderz=[],e.guiderzIdx=0,e.waitGuide=!0,e.useSpwanobstacle=!0,e.initOk=!1,e.fastRunScore=0,e.challengIdx=-1,e.canJump=!1,e._gameModule=null,e._aniArray=null,e._levelEndPos=[520,1240,2360,4080],e._endLevelObjectArray=null,e._levelSpeed=[.02,.05,.08,.15,.48],e._level=0,e.isfadeToIdel=!1,e.challengeOk=!1,e.guideAcionOk=!1,e}return _inherits(GameScript,Laya.Script),_createClass(GameScript,[{key:"onAwake",value:function(){GameScript.instance=this,this.scene=this.owner,this._gameModule=fe.instance.gameModule,this.scene.addComponent(P),this._aniArray=[],this.initSound(),this.initSkyBox(),this.addLevelEnd(),this.camera=E.Find(this.scene,"PlayerPivot/Main Camera"),this.camera.transform.localPositionX=0,this.addPlayer()}},{key:"initOffsetEnd",value:function(){var e=Laya.loader.getRes("config/model_12.json").ed.model_12Table;return 2*this.organizeData(e).length}},{key:"organizeData",value:function(e){var t=[];for(var n in e){var a=e[n];t.push(a)}return t}},{key:"initSound",value:function(){u.supportSubPackage()&&0==GameScript.subSoundIsOk&&u.loadSubpackage_Single("SoundGame",this,this.onSubpackgeLoadOk),0==u.supportSubPackage()&&(GameScript.subSoundIsOk=!0)}},{key:"initSkyBox",value:function(){var e=E.Find(this.scene,"PlayerPivot/Sky");q.initShader(),e.meshRenderer.material=new q}},{key:"addLevelEnd",value:function(){null==this._endLevelObjectArray&&(this._endLevelObjectArray=[]);for(var t=E.Find(this.scene,"Resources/end"),n=0;n<this._levelEndPos.length;n++){var a=Laya.Sprite3D.instantiate(t),i=this._levelEndPos[n]-24+(e.isGuide?40:0);a.active=!0,(a=this.addLevelEndCollsion(a)).transform.position=new Laya.Vector3(0,0,i),this.scene.addChild(a),this._endLevelObjectArray.push(a)}}},{key:"addLevelEndCollsion",value:function(e){var t=new A;return t.mask=O.End,t.collisionMask=0,t.size=new Laya.Vector3(12,5,.5),t.center=new Laya.Vector3(0,3,0),e.addComponentIntance(t),e}},{key:"removeLevelEnd",value:function(){for(var e=0;e<this._endLevelObjectArray.length;e++){var t=this._endLevelObjectArray[e];t.removeSelf(),t.destroy()}this._endLevelObjectArray=null}},{key:"onSubpackgeLoadOk",value:function(e){GameScript.subSoundIsOk=!0,e&&this.isPlay&&o.instance.PlayGameBgm()}},{key:"onStart",value:function(){this.addBuild(),this.addHouse(),this.addObstacle(),this.initOk=!0}},{key:"addBuild",value:function(){var e=new U;e.spwanConfigObj=JSON.parse('{"findRoot":"Resources/BuildItem","spwanItemDatas":[{"goName":"IndustrialWarehouse01","length":20},{"goName":"IndustrialWarehouse03","length":20}],"startCreateZ":0.0,"CreateLength":100.0,"recoverOffset":-15.0}'),e.scene=this.scene,this.scene.addComponentIntance(e),this.spwans.push(e)}},{key:"initFinishFlag",value:function(){this.qizi=E.Find(GameScript.instance.scene,"beibaiqi"),this.qizi.active=!1}},{key:"addSpwanFish",value:function(){if(b.spwanFish){var e=new N;e.spwanConfigObj=JSON.parse('{"findRoot":"Resources/items","spwanItemDatas":[{"goName":"Fish","length":1.0}],"startCreateZ":30.0,"CreateLength":100.0,"recoverOffset":-5.0}'),e.scene=this.scene,this.scene.addComponentIntance(e),this.spwans.push(e)}}},{key:"addObstacle",value:function(){if(b.spwanObstacle){var e=new Y;e.spwanConfigObj=JSON.parse('{"findRoot":"Resources/items","spwanItemDatas":[{"goName":"jiasu","length":2},{"goName":"jinbi","length":2},{"goName":"jinche","length":4},{"goName":"chonglangban","length":2},{"goName":"xiahualangan","length":2},{"goName":"shangche","length":4},{"goName":"dabache","length":18},{"goName":"dabacheding","length":18},{"goName":"huapo","length":6},{"goName":"guanggaopai","length":4},{"goName":"jiazi","length":3},{"goName":"ludeng","length":4},{"goName":"xiaofangshuan","length":1},{"goName":"lajitong","length":1.5},{"goName":"clbani_r","length":2},{"goName":"clbani_l","length":2}],"startCreateZ":0.0,"CreateLength":100.0,"recoverOffset":-10.0}'),e.scene=this.scene,this.scene.addComponentIntance(e),this.spwans.push(e),this.obstacleSpawn=e}}},{key:"addHouse",value:function(){var e='{"findRoot":"Resources/house","spwanItemDatas":[{"goName":"fangzi1","length":16},{"goName":"fangzi2","length":17},{"goName":"fangzi3","length":18},{"goName":"fangzi4","length":10}, {"goName":"fangzi5","length":10},{"goName":"fangzi6","length":12}],"startCreateZ":0.0,"CreateLength":100.0,"recoverOffset":-5.0}',t=new F(1);t.spwanConfigObj=JSON.parse(e),t.scene=this.scene,this.scene.addComponentIntance(t),this.spwans.push(t);var n=new F(-1);n.spwanConfigObj=JSON.parse(e),n.scene=this.scene,this.scene.addComponentIntance(n),this.spwans.push(n)}},{key:"addPlayer",value:function(){this.playerPivot=this.scene.getChildByName("PlayerPivot");var e=E.Find(this.scene,"PlayerPivot/charater");this.playerPivot.transform.position=new Laya.Vector3(0,0,0),e.transform.position=new Laya.Vector3(0,0,-3.5),this.player=e.addComponent(K),this._test=e}},{key:"startGmae",value:function(){var e=this;if(this.player.rebornRead)return this.player.StartRun(),Laya.timer.frameOnce(200,this,function(){e.isPlay=!0,e.speed=e.baseSpeed,GameScript.instance.setLevelAddSpeed(!1,!1),e.player.rebornRead=!1}),void(GameScript.subSoundIsOk&&o.instance.PlayGameBgm());this.player.StartRun(),Laya.timer.frameOnce(200,this,function(){e.isPlay=!0,GameScript.instance.setLevelAddSpeed(!1,!1)}),GameScript.subSoundIsOk&&o.instance.PlayGameBgm()}},{key:"setLevelAddSpeed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?this._levelAddSpeed=0:(t&&(this._level+=1),this._levelAddSpeed=this._levelSpeed[this._level])}},{key:"getLevel",value:function(){return this._level}},{key:"onUpdate",value:function(){if(this.isPlay){this.speed<=0&&(this.speed=0);var t=(this.speed+this.addspeed+this.jumpaddspeed+this._levelAddSpeed)*n.deltaTime*50;this.cureentZ+=t,e.isGuide&&-1==this.challengIdx&&0==this.guideAcionOk&&this.cureentZ>=this.guiderz[this.guiderzIdx]&&(this.cureentZ=this.guiderz[this.guiderzIdx],this.waitGuide&&(this.player.StartGuider(this.guiderzIdx),1==this.guiderzIdx?this._gameModule.DoShowGuideFinger(1):0==this.guiderzIdx&&this._gameModule.DoShowGuideFinger(0)),this.waitGuide=!1)}for(var a=0;a<this.spwans.length;a++)this.spwans[a].currentZ=this.cureentZ;if(0!=this.aniArray.length)for(var i=0;i<this.aniArray.length;i++){var o=this.aniArray[i];if(o.transform.localPositionZ-this.cureentZ<7.5)return o.getChildAt(0).getComponent(Laya.Animator).play("ani"),void this.aniArray.splice(i,1)}}},{key:"onLateUpdate",value:function(){var e=this.playerPivot.transform.position;e.z=this.cureentZ,this.playerPivot.transform.position=e}},{key:"playerEatFish",value:function(){this._gameModule.model.fishCount+=1,o.instance.FishCollection.Play()}},{key:"NextGuide",value:function(){this.guiderzIdx+=1,this.waitGuide=!0,this._gameModule.ClearFinger()}},{key:"WaitGuiEnd",value:function(){this.guideAcionOk=!0,this._gameModule.ClearFinger()}},{key:"GuideOk",value:function(){e.isGuide=!1,this._gameModule.model.guideOK(),this._gameModule.ClearFinger()}},{key:"onDestroy",value:function(){GameScript.instance=null,this.removeLevelEnd(),this.player.destroy(),this.player=null,this.destoryAABB()}},{key:"destoryAABB",value:function(){for(var e=0;e<this.spwans.length;e++){var t=this.spwans[e];t.recoverAll(),t.destroy(),t=null}}},{key:"aniArray",get:function(){return this._aniArray}}]),GameScript}();$.subSoundIsOk=!1;var Q=function(e){function BaseModel(){return _classCallCheck(this,BaseModel),_possibleConstructorReturn(this,_getPrototypeOf(BaseModel).call(this))}return _inherits(BaseModel,Laya.EventDispatcher),_createClass(BaseModel,[{key:"regist",value:function(){}},{key:"destory",value:function(){}}]),BaseModel}(),ee=function(n){function GameModel(){var e;return _classCallCheck(this,GameModel),(e=_possibleConstructorReturn(this,_getPrototypeOf(GameModel).call(this)))._score=0,e._fishCount=0,e._startTime="",e._endTime="",e._collectionShopDataArray=null,e._usedCollectionShopArray=null,e._tipMessage="",e}return _inherits(GameModel,Q),_createClass(GameModel,[{key:"regist",value:function(){var t=this;_get(_getPrototypeOf(GameModel.prototype),"regist",this).call(this),this._collectionShopDataArray=[],this._usedCollectionShopArray=[],window.platform.doInitActivity().then(function(n){if(1==n.success){e.isGuide=n.isGuide,t._tipMessage=n.message,t._startTime=n.startTime,t._endTime=n.endTime;for(var a=0;a<n.collectionCommoditys.length;a++){var i={},o=n.collectionCommoditys[a];i.imgUrl=o.imgUrl,i.price=o.price,i.commodityId=o.commodityId,i.title=o.title,t._collectionShopDataArray.push(i)}console.log("初始化成功")}},function(e){console.log(e),g.log("初始化数据失败")})}},{key:"getCollectionShopData",value:function(){return null!=this._collectionShopDataArray&&this._collectionShopDataArray.length>0?this._collectionShopDataArray.pop():null}},{key:"resetCollectionShopData",value:function(e){this._collectionShopDataArray=[];for(var t=0;t<e.length;t++){var n={},a=e[t];n.imgUrl=a.imgUrl,n.price=a.price,n.commodityId=a.commodityId,n.title=a.title,this._collectionShopDataArray.push(n)}}},{key:"setUsedCollectionShopArray",value:function(e){this._usedCollectionShopArray.push(e)}},{key:"getCollectTimes",value:function(){return this._usedCollectionShopArray.length}},{key:"isOver",value:function(){var e=this._usedCollectionShopArray.length>=3;return console.log("isOver",e),e}},{key:"getUsedCollectionShops",value:function(){return this._usedCollectionShopArray}},{key:"guideOK",value:function(){t.SetInt("Guidev2",1)}},{key:"startTime",get:function(){return this._startTime}},{key:"endTime",get:function(){return this._endTime}},{key:"score",get:function(){return this._score},set:function(e){e!=this._score&&(this._score=e,this.event(L.SCORE_CHANGE,this._score))}},{key:"fishCount",get:function(){return this._fishCount},set:function(e){e!=this._fishCount&&(this._fishCount=e,this.event(L.FISH_COUNT_CHANGE,this._fishCount))}},{key:"collectionShopDataArray",get:function(){return this._collectionShopDataArray}}]),GameModel}(),te=function UIEvent(){_classCallCheck(this,UIEvent)};te.OPEN="Open",te.CLOSE="Close";var ne=function(){function UIManager(){_classCallCheck(this,UIManager),this._uiDic=null,this.init()}return _createClass(UIManager,[{key:"init",value:function(){this._uiDic=new v}},{key:"destory",value:function(){if(null!=this._uiDic)for(var e=0;e<this._uiDic.values.length;e++){var t=this._uiDic.values[e];null!=t&&t.destroy()}}},{key:"open",value:function(e){this._uiDic.indexOf(e.name)>-1?g.log("UI已打开："+e.name):this._uiDic.setValue(e.name,e)}},{key:"close",value:function(e){this._uiDic.indexOf(e.name)>-1?this._uiDic.remove(e.name):g.log("UI不存在："+e.name)}},{key:"closeAll",value:function(){for(var e=0;e<this._uiDic.values.length;e++){var t=this._uiDic.values[e];t.close(),this._uiDic.remove(t.name)}}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new UIManager),this._instance}}]),UIManager}();ne._instance=null;var ae=function(e){function BaseView(){var e;return _classCallCheck(this,BaseView),(e=_possibleConstructorReturn(this,_getPrototypeOf(BaseView).call(this,!1)))._urlArray=null,e._atlasUrl="",e._isLoading=!1,e._isLoaded=!1,e._parentLayer=null,e._isAnimation=!0,e._loadCompleteCallBack=null,e.init(),e}return _inherits(BaseView,Laya.Scene),_createClass(BaseView,[{key:"init",value:function(){this.setBindUrl(),this._urlArray=[{url:this._atlasUrl,type:Laya.Loader.ATLAS},{url:this.url,type:Laya.Loader.JSON}],this.setParentLayer()}},{key:"setBindUrl",value:function(){}},{key:"setParentLayer",value:function(){this._parentLayer=_.instance.getLayer(p)}},{key:"openView",value:function(e){this._isLoading||(this._loadCompleteCallBack=e,this._isLoaded?this.doOpen():this.doLoad())}},{key:"doLoad",value:function(){Laya.loader.load(this._urlArray,Laya.Handler.create(this,this.onLoadComplete)),this._isLoading=!0}},{key:"onLoadComplete",value:function(){this._isLoading=!1,this._isLoaded=!0,this.doOpen()}},{key:"doOpen",value:function(){this.createChildren(),this.open()}},{key:"createChildren",value:function(){_get(_getPrototypeOf(BaseView.prototype),"createChildren",this).call(this),this.createView(Laya.loader.getRes(this.url)),this.initChildren()}},{key:"initChildren",value:function(){}},{key:"open",value:function(e,t){if(e&&ne.instance.closeAll(),null==this._parentLayer)throw"this._parent未赋值，请使用openView函数";this.initAnchor(),this.initScaleAndAlpha(),this._parentLayer.addChild(this),this.onOpened(t),this._isAnimation?this.openAnimation():ne.instance.open(this),this._loadCompleteCallBack()}},{key:"initAnchor",value:function(){this.width&&this.height&&(this.width=Laya.stage.width,this.height=Laya.stage.height,this.pivot(Laya.stage.width/2,Laya.stage.height/2),this.x=Laya.stage.width/2,this.y=Laya.stage.height/2)}},{key:"initScaleAndAlpha",value:function(){this.scale(0,0),this.alpha=0}},{key:"openAnimation",value:function(){Laya.Tween.to(this,{scaleX:1,scaleY:1,alpha:1},400,Laya.Ease.backOut,Laya.Handler.create(this,this.onOpenAniComplete))}},{key:"onOpenAniComplete",value:function(){ne.instance.open(this)}},{key:"closeAnimation",value:function(){Laya.Tween.to(this,{scaleX:0,scaleY:0,alpha:0},400,Laya.Ease.backIn,Laya.Handler.create(this,this.onCloseAniComplete))}},{key:"hideWindow",value:function(e,t){this.removeSelf(),ne.instance.close(this),this.event(te.CLOSE),e&&this.destroy(t)}},{key:"onCloseAniComplete",value:function(){this.hideWindow()}},{key:"cancelLoad",value:function(){null!=this._urlArray&&Laya.loader.cancelLoadByUrls(this._urlArray)}},{key:"closeView",value:function(e){this._isLoading?this.cancelLoad():this._isAnimation?this.closeAnimation():this.hideWindow(e)}},{key:"destroy",value:function(e){this._isAnimation=!1,this._isLoading=!1,this._isLoaded=!1,Laya.Tween.clearTween(this),this.cancelLoad(),_get(_getPrototypeOf(BaseView.prototype),"destroy",this).call(this,e)}},{key:"isAnimation",set:function(e){this._isAnimation=e}}]),BaseView}(),ie=function(e){function GameView(){return _classCallCheck(this,GameView),_possibleConstructorReturn(this,_getPrototypeOf(GameView).call(this))}return _inherits(GameView,ae),_createClass(GameView,[{key:"setBindUrl",value:function(){this._atlasUrl="res/atlas/game.atlas",this.url="views/game.json"}},{key:"initChildren",value:function(){this.fishImage.visible=!0}},{key:"showTimeImage",value:function(e){this.timeImage.alpha=0,this.timeImage.scale(.1,.1),this.timeImage.skin="game/"+e+".png",Laya.Tween.to(this.timeImage,{alpha:1,scaleX:1,scaleY:1},100,Laya.Ease.backIn)}}]),GameView}(),oe=function(t){function GameModule(){var e;return _classCallCheck(this,GameModule),(e=_possibleConstructorReturn(this,_getPrototypeOf(GameModule).call(this)))._controllView=null,e.hitfontIdx=1,e._scene=null,e._countDownTime=3,e}return _inherits(GameModule,C),_createClass(GameModule,[{key:"addView",value:function(){this._view=new ie,this._controllView=this._view}},{key:"addModel",value:function(){this._model=new ee}},{key:"open",value:function(){this.addEvent(),this.loadScene3D(),this.initScore()}},{key:"setCallBack",value:function(e){this.progress=e}},{key:"addEvent",value:function(){this._model.on(L.SCORE_CHANGE,this,this.scoreChange),this._model.on(L.FISH_COUNT_CHANGE,this,this.fishCountChange),this._controllView.voice.on(Laya.Event.CLICK,this,this.changeVoiceState)}},{key:"removeEvent",value:function(){this._model.off(L.SCORE_CHANGE,this,this.scoreChange),this._model.off(L.FISH_COUNT_CHANGE,this,this.fishCountChange),this._controllView.voice.off(Laya.Event.CLICK,this,this.changeVoiceState)}},{key:"changeVoiceState",value:function(){(e.isOpenSound=!e.isOpenSound)?(this._controllView.voice.skin="game/voice.png",o.instance.PlayGameBgm()):(this._controllView.voice.skin="game/voice_close.png",o.instance.stopBgm())}},{key:"fishCountChange",value:function(e){this._controllView.fishfont&&(this._controllView.fishfont.value=e)}},{key:"scoreChange",value:function(e){this._controllView.score&&(this._controllView.score.value=e)}},{key:"loadScene3D",value:function(){Laya.Scene3D.load("res3d/Game.ls",Laya.Handler.create(this,this.onGameSceneLoadOk),Laya.Handler.create(this,this.onProgress))}},{key:"onProgress",value:function(e){this.progress(e)}},{key:"onGameSceneLoadOk",value:function(e){fe.instance.openLoadingView(!1),_.instance.getLayer(f).addChild(e),this._scene=e,this.createGameScene(),Laya.timer.once(600,this,this.startGame)}},{key:"startGame",value:function(){this._countDownTime=3,this._controllView.timeImage.alpha=1,this._controllView.timeImage.scale(1,1),this._controllView.timeImage.visible=!0,this._controllView.showTimeImage(this._countDownTime),Laya.timer.loop(1e3,this,this.countDown)}},{key:"countDown",value:function(){if(this._countDownTime-=1,0==this._countDownTime)return Laya.timer.clear(this,this.countDown),this._controllView.timeImage.visible=!1,void this.startboxClick();this._controllView.showTimeImage(this._countDownTime)}},{key:"createGameScene",value:function(){this._scene.addComponent($)}},{key:"initScore",value:function(){this.fishCountChange(0)}},{key:"showView",value:function(){this._view.visible=!0}},{key:"hideView",value:function(){this._view.visible=!1}},{key:"startboxClick",value:function(){null!=$.instance&&0!=$.instance.initOk&&($.instance.startGmae(),console.log("开始游戏"))}},{key:"hideFishAndScore",value:function(){this._controllView.fishfont.visible=!1}},{key:"reborn",value:function(){this._controllView.fishfont.visible=!0,this.startGame()}},{key:"ClearFinger",value:function(){k.instance.clearAll(this._controllView.finger),this._controllView.finger.visible=!1,this._controllView.arrowFlashesAni.visible=!1}},{key:"DoShowGuideFinger",value:function(e){this._controllView.finger.visible=!0,this._controllView.arrowFlashesAni.visible=!0;var t=.5*this._controllView.width,n=.5*this._controllView.height;0==e&&(this._controllView.finger.y=n+300,this._controllView.finger.x=t,this._controllView.arrowFlashesAni.play(),k.instance.toPositionRePlay(this._controllView.finger,new Laya.Vector2(t,n),800)),1==e&&(this._controllView.finger.y=n-150,this._controllView.finger.x=t,this._controllView.arrowFlashesAni.scaleY=-1,k.instance.toPositionRePlay(this._controllView.finger,new Laya.Vector2(t,n+150),800)),2==e&&(this._controllView.finger.y=n,this._controllView.finger.x=t-250,k.instance.toPositionRePlay(this._controllView.finger,new Laya.Vector2(t+250,n),1e3)),3==e&&(this._controllView.finger.y=n,this._controllView.finger.x=t+250,k.instance.toPositionRePlay(this._controllView.finger,new Laya.Vector2(t-250,n),1e3)),4==e&&(this._controllView.finger.y=n,this._controllView.finger.x=t,k.instance.toScaleRePlay(this._controllView.finger,new Laya.Vector2(1.2,1.2),1e3))}},{key:"uninitialize",value:function(){this.removeEvent(),this._scene.getComponent($).destroy(),this._controllView&&(this._controllView.closeView(!0),this._controllView=null),_get(_getPrototypeOf(GameModule.prototype),"uninitialize",this).call(this)}},{key:"model",get:function(){return this._model}}]),GameModule}(),se=function(e){function LoadingView(){var e;return _classCallCheck(this,LoadingView),(e=_possibleConstructorReturn(this,_getPrototypeOf(LoadingView).call(this)))._rectMask=null,e.maskWidth=408,e}return _inherits(LoadingView,ae),_createClass(LoadingView,[{key:"setBindUrl",value:function(){this._atlasUrl="res/atlas/loading.atlas",this.url="views/loading.json"}},{key:"initChildren",value:function(){this.initMask()}},{key:"initMask",value:function(){this._rectMask=new Laya.Sprite,this._rectMask.graphics.drawRect(this.progressBg.x-this.maskWidth,this.progressBg.y,this.maskWidth,26,"#ffffff"),this.progressValue.mask=this._rectMask,this.cat.x=0}},{key:"updataProgress",value:function(e){this._rectMask.x>=this.maskWidth&&(this._rectMask.x=this.maskWidth),this._rectMask.x=e*this.maskWidth,this.cat.x=292*e}}]),LoadingView}(),re=function(e){function LoadingModule(){var e;return _classCallCheck(this,LoadingModule),(e=_possibleConstructorReturn(this,_getPrototypeOf(LoadingModule).call(this))).fileLoadOk=!1,e.currentProgress=0,e._view=null,e}return _inherits(LoadingModule,C),_createClass(LoadingModule,[{key:"open",value:function(){var e=this;fe.instance.openGameScene(!0,function(t){e._view.updataProgress(t)})}},{key:"addView",value:function(){this._view=new se}},{key:"closeWindow",value:function(){_get(_getPrototypeOf(LoadingModule.prototype),"closeWindow",this).call(this)}}]),LoadingModule}(),le=function(){function TimeUtil(){_classCallCheck(this,TimeUtil)}return _createClass(TimeUtil,[{key:"toTimeStamp",value:function(e){return new Date(e).getTime()}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new TimeUtil),this._instance}}]),TimeUtil}();le._instance=null;var ue=function(e){function OverMoedl(){return _classCallCheck(this,OverMoedl),_possibleConstructorReturn(this,_getPrototypeOf(OverMoedl).call(this))}return _inherits(OverMoedl,Q),OverMoedl}(),ce=function(e){function OverView(){return _classCallCheck(this,OverView),_possibleConstructorReturn(this,_getPrototypeOf(OverView).call(this))}return _inherits(OverView,ae),_createClass(OverView,[{key:"setBindUrl",value:function(){this._atlasUrl="res/atlas/over.atlas",this.url="views/over.json"}},{key:"updataGold",value:function(e){this.label_gold.text=e.toString()}},{key:"updataLabelCardsNumber",value:function(e){this.label_cards.text=e.toString()+"张"}},{key:"initChildren",value:function(){this.star.alpha=0,this.star.scale(.6,.6),this.playStarAni()}},{key:"playStarAni",value:function(){Laya.Tween.to(this.star,{alpha:1},30,null).to(this.star,{scaleX:3,scaleY:3,alpha:1},3e3,null,Laya.Handler.create(this,this.complete))}},{key:"complete",value:function(){this.star.alpha=0,this.star.scale(.6,.6),this.playStarAni()}},{key:"setItemIamge",value:function(e){this.item.loadImage(e)}},{key:"destroy",value:function(){Laya.Tween.clearTween(this.star)}}]),OverView}(),he=function(t){function OverModule(){var e;return _classCallCheck(this,OverModule),(e=_possibleConstructorReturn(this,_getPrototypeOf(OverModule).call(this)))._controllView=null,e._gameModule=null,e._getCollectionShopData=null,e._isGet=!1,e}return _inherits(OverModule,C),_createClass(OverModule,[{key:"addView",value:function(){this._view=new ce,this._controllView=this._view}},{key:"addModel",value:function(){this._model=new ue}},{key:"open",value:function(){this._gameModule=fe.instance.gameModule,this.addEvent(),this.initView()}},{key:"initView",value:function(){e.gameOver?this.openResultCon(!0):this.checkTimesOver()?this.openResultCon(!1):this.openRebornCon()}},{key:"addEvent",value:function(){this._controllView.reborn.clickHandler=Laya.Handler.create(this,this.onClickReborn,null,!1),this._controllView.no.on(Laya.Event.CLICK,this,this.exitGame),this._controllView.btn_close.on(Laya.Event.CLICK,this,this.gotoHome),this._controllView.again.clickHandler=Laya.Handler.create(this,this.onClickAgainGame,null,!1)}},{key:"removeEvent",value:function(){this._controllView.reborn.clickHandler.recover(),this._controllView.no.off(Laya.Event.CLICK,this,this.exitGame),this._controllView.btn_close.off(Laya.Event.CLICK,this,this.gotoHome),this._controllView.again.clickHandler.recover()}},{key:"onClickReborn",value:function(){var e=this;null!=this._getCollectionShopData&&(this._isGet||(this._isGet=!0,window.platform.goodsCollected(this._getCollectionShopData.commodityId).then(function(t){1==t.success?(e.closeWindow(),e._gameModule.model.setUsedCollectionShopArray(e._getCollectionShopData.commodityId),$.instance.player.Reborn()):(e.openResultCon(),e._isGet=!1)},function(e){g.log("服务器返回错误",e),fe.instance.showTips("游戏异常，请联系客服")})))}},{key:"exitGame",value:function(){this.openResultCon()}},{key:"closeWindow",value:function(){this.removeEvent(),_get(_getPrototypeOf(OverModule.prototype),"closeWindow",this).call(this)}},{key:"gotoHome",value:function(t,n){this.closeWindow(),e.isBaoXiang?window.platform.goBoxHome(t,n):window.platform.goHome(),fe.instance.destory(),_.instance.destory(),Laya.stage.destroy(),g.log("游戏已销毁")}},{key:"onClickAgainGame",value:function(){var t=this,n=this._gameModule.model.startTime,a=this._gameModule.model.endTime,i=le.instance.toTimeStamp(n),o=le.instance.toTimeStamp(a),s=(new Date).getTime();s<i?fe.instance.showTips("活动未开始"):s>o?fe.instance.showTips("活动已结束"):window.platform.getRest().then(function(n){1==n.success?(console.log("重新开始游戏"),t.closeWindow(),e.gameOver=!1,fe.instance.restartGame()):fe.instance.showTips("挑战次数不足，明日再来")},function(e){g.log(e),fe.instance.showTips("游戏异常，请联系客服")})}},{key:"openResultCon",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this._gameModule.model.getUsedCollectionShops(),i=a.length;e.isBaoXiang?window.platform.updateGold(this._gameModule.model.fishCount,i,a).then(function(e){1==e.success?t.gotoHome(n,t._gameModule.model.fishCount):fe.instance.showTips("游戏异常，请联系客服")},function(e){g.log(e),fe.instance.showTips("游戏异常，请联系客服")}):(this.changeContainer(!0),this.changeResultBg(n),this._controllView.updataGold(this._gameModule.model.fishCount),this._controllView.updataLabelCardsNumber(i),window.platform.updateGold(this._gameModule.model.fishCount,i,a))}},{key:"changeResultBg",value:function(e){this._controllView.win.visible=e,this._controllView.fail.visible=!e}},{key:"openRebornCon",value:function(){this._isGet=!1,this.changeContainer(!1),this._controllView.setItemIamge(this._getCollectionShopData.imgUrl)}},{key:"checkTimesOver",value:function(){var e=!1;return this._gameModule.model.isOver()?e=!0:(e=!1,this._getCollectionShopData=this._gameModule.model.getCollectionShopData()),e}},{key:"changeContainer",value:function(e){this._controllView.resultCon.visible=e,this._controllView.rebornCon.visible=!e}}]),OverModule}(),de=function(e){function ToastView(){var e;return _classCallCheck(this,ToastView),(e=_possibleConstructorReturn(this,_getPrototypeOf(ToastView).call(this))).toasMgsarr=null,e.toasShowing=!1,e.toasMgsarr=new Array,e}return _inherits(ToastView,ae),_createClass(ToastView,[{key:"setBindUrl",value:function(){this._atlasUrl="res/atlas/common.atlas",this.url="views/tip.json"}},{key:"setParentLayer",value:function(){this._parentLayer=_.instance.getLayer(m)}},{key:"initChildren",value:function(){}},{key:"pushtoas",value:function(e){this.toasMgsarr.push(e),this.showtoas()}},{key:"showtoas",value:function(){var e=1500;if(!this.toasShowing){this.bg.visible=!0,this.toasShowing=!0;var t=this.toasMgsarr.shift();if(this.toasMgsarr.length>=2&&(e=600),null==t)return this.toasShowing=!1,void(this.bg.visible=!1);this.tip.text=t,Laya.timer.once(e,this,this.distoasImg,null,!0)}}},{key:"distoasImg",value:function(){this.toasShowing=!1,this.bg.visible=!1,this.showtoas()}}]),ToastView}(),ye=function(e){function ToastModule(){return _classCallCheck(this,ToastModule),_possibleConstructorReturn(this,_getPrototypeOf(ToastModule).call(this))}return _inherits(ToastModule,C),_createClass(ToastModule,[{key:"addView",value:function(){this._view=new de}},{key:"open",value:function(){this._view.pushtoas(this._tips)}},{key:"showToas",value:function(e){this._tips=e}}]),ToastModule}(),fe=function(){function ModuleCenter(){_classCallCheck(this,ModuleCenter),this._moduleManager=null}return _createClass(ModuleCenter,[{key:"create",value:function(){this._moduleManager=new w,this.createModule(),this._moduleManager.initialize()}},{key:"createModule",value:function(){this._moduleManager.addModule(re),this._moduleManager.addModule(oe),this._moduleManager.addModule(he),this._moduleManager.addModule(ye)}},{key:"destory",value:function(){this._moduleManager.uninitialize(),this._moduleManager.removeAllModule(),this._moduleManager=null}},{key:"openLoadingView",value:function(e){var t=this._moduleManager.getModule(re);e?t.openWindow():t.closeWindow()}},{key:"openGameScene",value:function(e,t){var n=this._moduleManager.getModule(oe);e?(n.setCallBack(t),n.openWindow()):n.closeWindow()}},{key:"restartGame",value:function(){var e=this._moduleManager.getModule(oe);e.uninitialize(),e.initialize(),e.openWindow()}},{key:"showTips",value:function(e){var t=this._moduleManager.getModule(ye);t.showToas(e),t.openWindow()}},{key:"openOverView",value:function(e){var t=this._moduleManager.getModule(he);e?t.openWindow():t.closeWindow()}},{key:"gameModule",get:function(){return this._moduleManager.getModule(oe)}}],[{key:"instance",get:function(){return null==this._instance&&(this._instance=new ModuleCenter),this._instance}}]),ModuleCenter}();fe._instance=null;var me=function(e){function UnityEnagine(){var e;return _classCallCheck(this,UnityEnagine),(e=_possibleConstructorReturn(this,_getPrototypeOf(UnityEnagine).apply(this,arguments))).logFps=!1,e.openAppTimeSc=0,e.fpsTime=0,e.framCount=0,e.fps=0,e.fpsmin=9999,e.fpsMax=0,e}return _inherits(UnityEnagine,Laya.Script),_createClass(UnityEnagine,[{key:"onAwake",value:function(){this.owner.addComponent(J),this.openAppTimeSc=.001*Laya.timer.currTimer}},{key:"onUpdate",value:function(){n.fixedDeltaTime=Laya.timer.delta,n.deltaTime=.001*Laya.timer.delta,this.logFps&&this.calFps(),n.time=.001*Laya.timer.currTimer-this.openAppTimeSc}},{key:"calFps",value:function(){this.framCount+=1,this.fpsTime+=n.deltaTime,this.fpsTime>1&&(this.fps=this.framCount,this.fpsTime=0,this.framCount=0,this.fpsMax+=this.fps,this.fps<this.fpsmin&&(this.fpsmin=this.fps),console.log("fps 当前=",this.fps,"最小=",this.fpsmin,"总帧数",this.fpsMax))}}]),UnityEnagine}(),pe=function(){function GameEnter(){_classCallCheck(this,GameEnter),this._loadUrlArray=null,this._loadUrlArray=["config/random.json","config/model_0.json","config/model_1.json","config/model_2.json","config/model_3.json","config/model_4.json","config/model_5.json","config/model_6.json","config/model_7.json","config/model_8.json","config/model_9.json","config/model_10.json","config/model_11.json","config/model_12.json","over/starsky.png"],Laya.loader.load(this._loadUrlArray,Laya.Handler.create(this,this.init))}return _createClass(GameEnter,[{key:"init",value:function(){this.initUnityEngine(),this.initLayer(),fe.instance.create(),this.startGame()}},{key:"initUnityEngine",value:function(){var e=new Laya.Node;Laya.stage.addChild(e),e.addComponent(me)}},{key:"initLayer",value:function(){_.instance.addLayer(f),_.instance.addLayer(p),_.instance.addLayer(m)}},{key:"startGame",value:function(){fe.instance.openLoadingView(!0)}}]),GameEnter}();new(function(){function Main(){_classCallCheck(this,Main),window.Laya3D?Laya3D.init(h.width,h.height):Laya.init(h.width,h.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=h.scaleMode,Laya.stage.bgColor="#FFFFFF",Laya.stage.screenMode=h.screenMode,Laya.stage.alignV=h.alignV,Laya.stage.alignH=h.alignH,Laya.URL.exportSceneToJson=h.exportSceneToJson,Laya.URL.basePath="https://draw-mb.oss-cn-zhangjiakou.aliyuncs.com/laya/paoku/v1.0.1/",(h.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),h.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),h.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return _createClass(Main,[{key:"onVersionLoaded",value:function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}},{key:"onConfigLoaded",value:function(){new pe}}]),Main}())}();